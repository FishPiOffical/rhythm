var ArticleChannel={ws:void 0,init:function(e){ArticleChannel.ws=new ReconnectingWebSocket(e),ArticleChannel.ws.reconnectInterval=1e4,ArticleChannel.ws.onopen=function(){setInterval(function(){ArticleChannel.ws.send("-hb-")},18e4)},ArticleChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);if(Label.articleOId===n.articleId)switch(n.type){case"comment":var t,a=parseInt($(".comments-header .article-cmt-cnt").text())+1;$(".comments-header .article-cmt-cnt").text(a+" "+Label.cmtLabel),0===$("#comments .list > ul > li").length&&($(".comment-header > .fn-none").show(),$(".comments-header > .fn-none").show(),$("#articleCommentsPanel").parent().show()),0===Label.userCommentViewMode?$("#comments > .list > ul").append(n.cmtTpl):$("#comments > .list > ul").prepend(n.cmtTpl),$("#"+n.commentId+" .cmt-via").text("via "+Util.getDeviceByUa(n.commentUA)),Label.currentUserName===n.commentAuthorName&&Comment._bgFade($("#"+n.commentId)),""!==n.commentOriginalCommentId&&(1===(a=(t=$("#"+n.commentOriginalCommentId)).find(".comment-action > .ft-fade > .fn-pointer")).length?(a.html(" "+(parseInt($.trim(a.text()))+1)+" "+Label.replyLabel+' <span class="'+a.find("span").attr("class")+'"></span>'),"icon-chevron-up"===a.find("svg").attr("class")&&(a.find("svg").removeClass("icon-chevron-up").addClass("icon-chevron-down").find("use").attr("xlink:href","#chevron-down"),a.click())):t.find(".comment-action > .ft-fade").prepend('<span class="fn-pointer ft-smaller fn-left" onclick="Comment.showReply(\''+n.commentOriginalCommentId+"', this, 'comment-replies')\" style=\"opacity: 1;\"> 1 "+Label.replyLabel+' <svg class="icon-chevron-down"><use xlink:href="#chevron-down"></use></svg>')),Util.parseHljs(),Util.parseMarkdown();break;case"articleHeat":var o=$("#heatBar"),s=$(".heat");"+"===n.operation?(o.append('<i class="point"></i>'),setTimeout(function(){s.width($(".heat").width()+3),o.find(".point").remove()},2e3)):(s.width($(".heat").width()-3),o.append('<i class="point-remove"></i>'),setTimeout(function(){o.find(".point-remove").remove()},2e3));break;default:console.error("Wrong data [type="+n.type+"]")}},ArticleChannel.ws.onclose=function(){},ArticleChannel.ws.onerror=function(e){console.log(e)}}},ArticleListChannel={ws:void 0,init:function(e){ArticleListChannel.ws=new ReconnectingWebSocket(e),ArticleListChannel.ws.reconnectInterval=1e4,ArticleListChannel.ws.onopen=function(){setInterval(function(){ArticleListChannel.ws.send("-hb-")},18e4)},ArticleListChannel.ws.onmessage=function(e){var a=JSON.parse(e.data);$(".article-list h2 > a[rel=bookmark]").each(function(){var e,n,t=$(this).data("id").toString();a.articleId===t&&(e=$(this).closest("li"),n=e.find(".heat"),"+"===a.operation?(e.append('<i class="point"></i>'),setTimeout(function(){n.width(n.width()+3),e.find(".point").remove()},2e3)):(n.width(n.width()-3),e.append('<i class="point-remove"></i>'),setTimeout(function(){e.find(".point-remove").remove()},2e3)))})},ArticleListChannel.ws.onclose=function(){ArticleListChannel.ws.close()},ArticleListChannel.ws.onerror=function(e){console.log("ERROR",e)}}},IdleTalkChannel={ws:void 0,init:function(e){IdleTalkChannel.ws=new ReconnectingWebSocket(e),IdleTalkChannel.ws.reconnectInterval=1e4,IdleTalkChannel.ws.onopen=function(){setInterval(function(){IdleTalkChannel.ws.send("-hb-")},18e4)},IdleTalkChannel.ws.onmessage=function(e){var n=JSON.parse(e.data),t=n.command;switch(n.youAre){case"sender":var a='<li id="'+n.mapId+"\">\n    <div class='fn-flex'>\n<a href=\"/member/"+t.toUserName+'">        <div class="avatar tooltipped tooltipped-ne"\n             aria-label="'+t.toUserName+'"\n             style="background-image:url(\''+t.toUserAvatar+'\')"></div>\n</a>        <div class="fn-flex-1">\n            <h2>\n                <a href="/member/'+t.toUserName+'">发送给「'+t.toUserName+'」的私信</a>\n                <button class="btn fn-right" style="margin-left: 10px" onclick="IdleTalk.revoke(\''+n.mapId+'\')">撤回</button>\n            </h2>\n            <span class="ft-fade vditor-reset">\n                '+timeTrans(parseFloat(n.mapId))+" · 主题："+t.theme+"\n            </span>\n        </div>\n    </div>\n</li>";$("#sent").prepend(a),void 0!==$("#sent").find(".nope")[0]&&$("#sent").find(".nope")[0].remove();break;case"receiver":a='<li id="'+n.mapId+"\">\n    <div class='fn-flex'>\n<a href=\"/member/"+t.fromUserName+'">        <div class="avatar tooltipped tooltipped-ne"\n             aria-label="'+t.fromUserName+'"\n             style="background-image:url(\''+t.fromUserAvatar+'\')"></div>\n</a>        <div class="fn-flex-1">\n            <h2>\n                <a href="/member/'+t.fromUserName+'">来自「'+t.fromUserName+'」的私信</a>\n                <button class="red fn-right" onclick="IdleTalk.seek(\''+n.mapId+"', '"+t.fromUserName+"', '"+t.theme+'\')">查看并销毁</button>\n            </h2>\n            <span class="ft-fade vditor-reset">\n                '+timeTrans(parseFloat(n.mapId))+" · 主题："+t.theme+"\n            </span>\n        </div>\n    </div>\n</li>";$("#received").prepend(a),void 0!==$("#received").find(".nope")[0]&&$("#received").find(".nope")[0].remove();break;case"destroyIdleChatMessage":$("#"+t).remove(),void 0===$("#received").find("li")[0]&&void 0===$("#received").find(".nope")[0]&&$("#received").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有收到任何来信</div>'),void 0===$("#sent").find("li")[0]&&void 0===$("#sent").find(".nope")[0]&&$("#sent").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有未读的发信</div>')}},IdleTalkChannel.ws.onclose=function(){IdleTalkChannel.ws.close()},IdleTalkChannel.ws.onerror=function(e){console.log("ERROR",e)}}};function timeTrans(e){return(e=new Date(e)).getFullYear()+"年"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"月")+((e.getDate()<10?"0"+e.getDate():e.getDate())+"日 ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}var ChatRoomChannel={ws:void 0,init:function(e){ChatRoomChannel.ws=new ReconnectingWebSocket(e),ChatRoomChannel.ws.reconnectInterval=1e4,ChatRoomChannel.ws.onopen=function(){setInterval(function(){ChatRoomChannel.ws.send("-hb-")},18e4)},ChatRoomChannel.ws.onmessage=function(e){var t=JSON.parse(e.data);switch(t.type){case"online":for(var a in $("#onlineCnt").text(t.onlineChatCnt),$("#indexOnlineChatCnt").text(t.onlineChatCnt),$("#chatRoomOnlineCnt").html(""),t.users){a=t.users[a];$("#chatRoomOnlineCnt").append('<a target="_blank" data-name="'+a.userName+'"\nhref="'+a.homePage+'">\n<img style=\'margin-bottom: 10px\' class="avatar avatar-small" aria-label="'+a.userName+'"\nsrc="'+a.userAvatarURL+'">\n</a>')}Util.listenUserCard();break;case"revoke":$("#chatroom"+t.oId).remove(),$("#chatindex"+t.oId).remove();break;case"msg":if(0===$("#chatRoomIndex").length){let e;$("#plusOne").remove(),e=t.md===Label.latestMessage?ChatRoom.renderMessage(t.userNickname,t.userName,t.userAvatarURL,t.time,t.content,t.oId,Label.currentUser,Label.level3Permitted,!0):ChatRoom.renderMessage(t.userNickname,t.userName,t.userAvatarURL,t.time,t.content,t.oId,Label.currentUser,Label.level3Permitted),$("#chats").prepend(e),$("#chats>div.fn-none").show(200),$("#chats>div.fn-none").removeClass("fn-none"),ChatRoom.resetMoreBtnListen(),void 0!==t.md&&(Label.latestMessage=t.md)}0!==$("#chatRoomIndex").has("#emptyChatRoom").length&&$("#emptyChatRoom").remove();let e=t.userNickname;var o=t.userName;e=void 0!==e&&""!==e?e+" ( "+o+" )":o;let n=t.content;-1!==n.indexOf('"msgType":"redPacket"')&&(n="[收到红包，请在完整版聊天室查看]"),$("#chatRoomIndex").prepend('<li class="fn-flex" id="chatindex'+t.oId+'" style=\'display: none; border-bottom: 1px solid #eee;\'>\n    <a rel="nofollow" href="/member/'+t.userName+'">\n        <div class="avatar tooltipped tooltipped-n"\n             aria-label="'+t.userName+'"\n             style="background-image:url(\''+t.userAvatarURL+'\')"></div>\n    </a>\n    <div class="fn-flex-1">\n        <div class="ft-smaller">\n            <a rel="nofollow" href="/member/'+t.userName+'">\n                <span class="ft-gray">'+e+'</span>\n            </a>\n        </div>\n        <div class="vditor-reset comment '+Label.chatRoomPictureStatus+'">\n            '+n+"\n        </div>\n    </div>\n</li>"),11===$("#chatRoomIndex li").length&&$("#chatRoomIndex li:last").remove(),$("#chatRoomIndex li:first").slideDown(200),Util.listenUserCard()}},ChatRoomChannel.ws.onclose=function(){ChatRoomChannel.ws.close()},ChatRoomChannel.ws.onerror=function(e){console.log("ERROR",e)}}},GobangChannel={ws:void 0,init:function(e){GobangChannel.ws=new ReconnectingWebSocket(e),GobangChannel.ws.reconnectInterval=1e4,GobangChannel.ws.onopen=function(){setInterval(function(){GobangChannel.ws.send("zephyr test")},18e4)},GobangChannel.ws.onmessage=function(e){switch(JSON.parse(e.data).type){case"gobangPlayer":console.log("data.type:>gobangPlayer");break;case"msg":console.log("data.type:>msg")}},GobangChannel.ws.onclose=function(){GobangChannel.ws.close()},GobangChannel.ws.onerror=function(e){console.log("ERROR",e)}}};