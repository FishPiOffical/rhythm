var ArticleChannel={ws:void 0,init:function(e){ArticleChannel.ws=new WebSocket(e),ArticleChannel.ws.onopen=function(){console.log("Connected to article channel websocket.")},ArticleChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);if(Label.articleOId===n.articleId)switch(n.type){case"comment":var t=parseInt($(".comments-header .article-cmt-cnt").text())+1;if($(".comments-header .article-cmt-cnt").text(t+" "+Label.cmtLabel),0===$("#comments .list > ul > li").length&&($(".comment-header > .fn-none").show(),$(".comments-header > .fn-none").show(),$("#articleCommentsPanel").parent().show()),0===Label.userCommentViewMode?$("#comments > .list > ul").append(n.cmtTpl):$("#comments > .list > ul").prepend(n.cmtTpl),$("#"+n.commentId+" .cmt-via").text("via "+Util.getDeviceByUa(n.commentUA)),Label.currentUserName===n.commentAuthorName&&Comment._bgFade($("#"+n.commentId)),""!==n.commentOriginalCommentId){var a=$("#"+n.commentOriginalCommentId),o=a.find(".comment-action > .ft-fade > .fn-pointer");1===o.length?(o.html(" "+(parseInt($.trim(o.text()))+1)+" "+Label.replyLabel+' <span class="'+o.find("span").attr("class")+'"></span>'),"icon-chevron-up"===o.find("svg").attr("class")&&(o.find("svg").removeClass("icon-chevron-up").addClass("icon-chevron-down").find("use").attr("xlink:href","#chevron-down"),o.click())):a.find(".comment-action > .ft-fade").prepend('<span class="fn-pointer ft-smaller fn-left" onclick="Comment.showReply(\''+n.commentOriginalCommentId+"', this, 'comment-replies')\" style=\"opacity: 1;\"> 1 "+Label.replyLabel+' <svg class="icon-chevron-down"><use xlink:href="#chevron-down"></use></svg>')}Util.parseHljs(),Util.parseMarkdown();break;case"articleHeat":var s=$("#heatBar"),l=$(".heat");"+"===n.operation?(s.append('<i class="point"></i>'),setTimeout((function(){l.width($(".heat").width()+3),s.find(".point").remove()}),2e3)):(l.width($(".heat").width()-3),s.append('<i class="point-remove"></i>'),setTimeout((function(){s.find(".point-remove").remove()}),2e3));break;default:console.error("Wrong data [type="+n.type+"]")}},ArticleChannel.ws.onclose=function(){console.log("Disconnected to article channel websocket.")},ArticleChannel.ws.onerror=function(e){console.log(e)}}},ArticleListChannel={ws:void 0,init:function(e){ArticleListChannel.ws=new WebSocket(e),ArticleListChannel.ws.onopen=function(){console.log("Connected to article list channel websocket.")},ArticleListChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);$(".article-list h2 > a[rel=bookmark]").each((function(){var e=$(this).data("id").toString();if(n.articleId===e){var t=$(this).closest("li"),a=t.find(".heat");"+"===n.operation?(t.append('<i class="point"></i>'),setTimeout((function(){a.width(a.width()+3),t.find(".point").remove()}),2e3)):(a.width(a.width()-3),t.append('<i class="point-remove"></i>'),setTimeout((function(){t.find(".point-remove").remove()}),2e3))}}))},ArticleListChannel.ws.onclose=function(){console.log("Disconnected to article list channel websocket.")},ArticleListChannel.ws.onerror=function(e){console.log("ERROR",e)}}},IdleTalkChannel={ws:void 0,init:function(e){IdleTalkChannel.ws=new WebSocket(e),IdleTalkChannel.ws.onopen=function(){console.log("Connected to idle talk channel websocket.")},IdleTalkChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);let t=n.command;switch(n.youAre){case"sender":let e='<li id="'+n.mapId+"\">\n    <div class='fn-flex'>\n<a href=\"/member/"+t.toUserName+'">        <div class="avatar tooltipped tooltipped-ne"\n             aria-label="'+t.toUserName+'"\n             style="background-image:url(\''+t.toUserAvatar+'\')"></div>\n</a>        <div class="fn-flex-1">\n            <h2>\n                <a href="/member/'+t.toUserName+'">发送给「'+t.toUserName+'」的私信</a>\n                <button class="btn fn-right" style="margin-left: 10px" onclick="IdleTalk.revoke(\''+n.mapId+'\')">撤回</button>\n            </h2>\n            <span class="ft-fade vditor-reset">\n                '+timeTrans(parseFloat(n.mapId))+" · 主题："+t.theme+"\n            </span>\n        </div>\n    </div>\n</li>";$("#sent").prepend(e),void 0!==$("#sent").find(".nope")[0]&&$("#sent").find(".nope")[0].remove();break;case"receiver":let a='<li id="'+n.mapId+"\">\n    <div class='fn-flex'>\n<a href=\"/member/"+t.fromUserName+'">        <div class="avatar tooltipped tooltipped-ne"\n             aria-label="'+t.fromUserName+'"\n             style="background-image:url(\''+t.fromUserAvatar+'\')"></div>\n</a>        <div class="fn-flex-1">\n            <h2>\n                <a href="/member/'+t.fromUserName+'">来自「'+t.fromUserName+'」的私信</a>\n                <button class="red fn-right" onclick="IdleTalk.seek(\''+n.mapId+"', '"+t.fromUserName+"', '"+t.theme+'\')">查看并销毁</button>\n            </h2>\n            <span class="ft-fade vditor-reset">\n                '+timeTrans(parseFloat(n.mapId))+" · 主题："+t.theme+"\n            </span>\n        </div>\n    </div>\n</li>";$("#received").prepend(a),void 0!==$("#received").find(".nope")[0]&&$("#received").find(".nope")[0].remove();break;case"destroyIdleChatMessage":$("#"+t).remove(),void 0===$("#received").find("li")[0]&&void 0===$("#received").find(".nope")[0]&&$("#received").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有收到任何来信</div>'),void 0===$("#sent").find("li")[0]&&void 0===$("#sent").find(".nope")[0]&&$("#sent").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有未读的发信</div>')}},IdleTalkChannel.ws.onclose=function(){console.log("Disconnected to idle talk channel websocket."),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)},IdleTalkChannel.ws.onerror=function(e){console.log("ERROR",e),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)}}};function timeTrans(e){return(e=new Date(e)).getFullYear()+"年"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"月")+((e.getDate()<10?"0"+e.getDate():e.getDate())+"日 ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}var ChatRoomChannel={ws:void 0,init:function(e){ChatRoomChannel.ws=new WebSocket(e),ChatRoomChannel.ws.onopen=function(){console.log("Connected to chatroom channel websocket.")},ChatRoomChannel.ws.onmessage=function(e){var n=JSON.parse(e.data);switch(n.type){case"barrager":let e=n.barragerContent,a=n.barragerColor,o=n.userName,s=n.userAvatarURL,l=n.userNickname,r="";r=""!=l&&null!=l?l+": "+e:o+": "+e;let i={img:s,info:r,href:Label.servePath+"/member/"+o,close:!1,speed:Math.round(10*Math.random()+10),color:a};$("body").barrager(i);break;case"discussChanged":let c=n.whoChanged,d=n.newDiscuss,m="<div class='newDiscussNotice' style='color: rgb(50 50 50);margin-bottom: 12px;text-align: center;display: none;'><svg><use xlink:href='#pound'></use></svg>&nbsp;<a href=\""+Label.servePath+"/member/"+c+'" target="_blank">'+c+"</a> 编辑了话题：<a href='javascript:void(0)' style='text-decoration: none'>"+d+"</a></div>";$("#chats").prepend(m),$(".newDiscussNotice").slideDown(500),$("#discuss-title").text(d);break;case"redPacketStatus":let h,f=n.whoGive,p=n.whoGot,u=n.got,g=n.count,v=n.oId,b=n.dice;if(null==b)h='<a href="'+Label.servePath+"/member/"+p+'" target="_blank">'+p+'</a> 抢到了 <a href="'+Label.servePath+"/member/"+f+'" target="_blank">'+f+'</a> 的 <a style="cursor: pointer" onclick="ChatRoom.unpackRedPacket(\''+v+"')\">红包</a>";else{let e;switch(b.bet){case"big":e="大";break;case"small":e="小";break;case"leopard":e="豹子"}let n=b.chips;h='<a href="'+Label.servePath+"/member/"+p+'" target="_blank">'+p+'</a> 在 <a href="'+Label.servePath+"/member/"+f+'" target="_blank">'+f+'</a> 的 <a style="cursor: pointer" onclick="ChatRoom.bet(\''+v+"')\">盘口</a> 下注"+n+"积分买"+e}u===g?($("#chatroom"+n.oId).find(".hongbao__item").css("opacity",".36"),$("#chatroom"+v).find(".hongbao__item").hasClass("opened")||$("#chatroom"+v).find(".hongbao__item").addClass("opened"),$("#chatroom"+n.oId+" .hongbao__item").removeAttr("onclick").attr("onclick","ChatRoom.unpackRedPacket("+v+");"),$("#chatroom"+n.oId).find(".redPacketDesc").html("已经被抢光啦"),h+=null==b?"，红包已被领完 ("+u+"/"+g+")":"，已封盘 ("+u+"/"+g+")"):h+=" ("+u+"/"+g+")";let w="<div class='redPacketNotice' style='color: rgb(50 50 50);margin-bottom: 12px;text-align: center;display: none;'><svg><use xlink:href='#redPacketIcon'></use></svg>&nbsp;"+h+"</div>";$("#chats").prepend(w),$(".redPacketNotice").slideDown(500);break;case"online":for(var t in $("#discuss-title").text(n.discussing),$("#onlineCnt").text(n.onlineChatCnt),$("#indexOnlineChatCnt").text(n.onlineChatCnt),Label.onlineAvatarData="",n.users){let e=n.users[t];Label.onlineAvatarData+='<a target="_blank" data-name="'+e.userName+'"\nhref="'+e.homePage+'">\n<img style=\'margin-bottom: 10px\' class="avatar avatar-small" aria-label="'+e.userName+'"\nsrc="'+e.userAvatarURL48+'">\n</a>'}Util.listenUserCard();break;case"revoke":$("#chatroom"+n.oId).remove(),$("#chatindex"+n.oId).remove();break;case"refresh":ChatRoom.flashScreen();break;case"customMessage":let C="<div class='customNotice' style='color: rgb(118 118 118);margin-bottom: 12px;text-align: center;display: none;'>"+n.message+"</div>";$("#chats").prepend(C),$(".customNotice").slideDown(500);break;case"refreshBarrager":$("#barragerCost").text(n.cost),$("#barragerUnit").text(n.unit);break;case"msg":0===$("#chatRoomIndex").length&&$("#chatroom"+n.oId).length<=0&&(ChatRoom.renderMsg(n),ChatRoom.resetMoreBtnListen()),0!==$("#chatRoomIndex").has("#emptyChatRoom").length&&$("#emptyChatRoom").remove();let k=n.userNickname,x=n.userName;k=void 0!==k&&""!==k?k+" ("+x+")":x;let I=n.content;-1!==I.indexOf('"msgType":"redPacket"')&&(I="[收到红包，请在完整版聊天室查看]"),-1!==I.indexOf('"msgType":"weather"')&&(I="[天气卡片，请在完整版聊天室查看]"),-1!==I.indexOf('"msgType":"music"')&&(I="[音乐卡片，请在完整版聊天室查看]"),$("#chatRoomIndex").prepend('<li class="fn-flex" id="chatindex'+n.oId+'" style=\'display: none; border-bottom: 1px solid #eee;\'>\n    <a rel="nofollow" href="/member/'+n.userName+'">\n        <div class="avatar tooltipped tooltipped-n"\n             aria-label="'+n.userName+'"\n             style="background-image:url(\''+n.userAvatarURL48+'\')"></div>\n    </a>\n    <div class="fn-flex-1">\n        <div class="ft-smaller">\n            <a rel="nofollow" href="/member/'+n.userName+'">\n                <span class="ft-gray">'+k+'</span>\n            </a>\n        </div>\n        <div class="vditor-reset comment '+Label.chatRoomPictureStatus+'">\n            '+ChatRoomChannel.filterContent(I)+"\n        </div>\n    </div>\n</li>"),11===$("#chatRoomIndex li.fn-flex").length&&$("#chatRoomIndex li.fn-flex:last").fadeOut(199,(function(){$("#chatRoomIndex li.fn-flex:last").remove()})),$("#chatRoomIndex li:first").slideDown(200),Util.listenUserCard(),"object"==typeof ChatRoom&&ChatRoom.imageViewer()}},ChatRoomChannel.ws.onclose=function(){console.log("Disconnected to chat room channel websocket."),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)},ChatRoomChannel.ws.onerror=function(e){console.log("ERROR",e),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)}},filterContent:function(e){let n=document.createElement("div");return n.innerHTML=e,n.querySelectorAll("img").forEach((e=>{e.src=e.src+"?imageView2/0/w/150/h/150/interlace/0/q/90"})),n.innerHTML}},GobangChannel={ws:void 0,init:function(e){GobangChannel.ws=new WebSocket(e),GobangChannel.ws.onopen=function(){console.log("Connected to gobang channel websocket."),setInterval((function(){GobangChannel.ws.send("zephyr test")}),55e3)},GobangChannel.ws.onmessage=function(e){switch(JSON.parse(e.data).type){case"gobangPlayer":console.log("data.type:>gobangPlayer");break;case"msg":console.log("data.type:>msg")}},GobangChannel.ws.onclose=function(){console.log("Disconnected to gobang channel websocket."),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)},GobangChannel.ws.onerror=function(e){console.log("ERROR",e),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)}}};