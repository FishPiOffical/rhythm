var Breezemoon={csrfToken:"",init:function(){$("#breezemoonInput").keyup((function(e){13===e.keyCode&&Breezemoon.add()})),this.csrfToken=$("#breezemoonBtn").data("csrftoken");var e=$("#breezemoonList");e.on("click",".rm",(function(){var e=$(this);Breezemoon.rm(e,e.closest("li").attr("id"))})),e.on("click",".edit",(function(){var e=$(this);Breezemoon.toggleUpdate(e,e.closest("li").attr("id"))})),e.find(".ua").each((function(){var e=$(this).data("ua"),t=Util.getDeviceByUa(e);""!==t&&$(this).text("via "+t)}))},add:function(){if(Label.isLoggedIn){var e=$("#breezemoonBtn");e.css("opacity",.3).attr("disabled"),$.ajax({url:Label.servePath+"/breezemoon",type:"POST",cache:!1,headers:{csrfToken:this.csrfToken},data:JSON.stringify({breezemoonContent:$("#breezemoonInput").val()}),success:function(e){0===e.code?window.location.reload():alert(e.msg)},complete:function(){e.css("opacity",1).removeAttr("disabled")}})}else alert(Label.reloginLabel)},rm:function(e,t){confirm(Label.confirmRemoveLabel)&&(e.css("opacity",.3).attr("disabled"),$.ajax({url:Label.servePath+"/breezemoon/"+t,type:"DELETE",headers:{csrfToken:this.csrfToken},cache:!1,success:function(t){0===t.code?e.closest("li").remove():alert(t.msg)},complete:function(){e.css("opacity",1).removeAttr("disabled")}}))},toggleUpdate:function(e,t){var o=e.closest("li"),n=o.find(".vditor-reset");if(1===o.find(".form").length)return n.show(),void o.find(".form").remove();n.hide(),n.after('<div class="form" style="margin-top: 15px"><input type="text" value="'+n.text()+'"  style="padding-right: 89px;"><button class="absolute">'+Label.breezemoonLabel+"</button></div>"),n.next().find("input").keyup((function(e){13===e.keyCode&&Breezemoon.update(n.next().find("button"),o.attr("id"),$(this).val())})),n.next().find("button").click((function(){Breezemoon.update($(this),o.attr("id"),n.next().find("input").val())}))},update:function(e,t,o){e.css("opacity",.3).attr("disabled"),$.ajax({url:Label.servePath+"/breezemoon/"+t,type:"PUT",cache:!1,headers:{csrfToken:this.csrfToken},data:JSON.stringify({breezemoonContent:o}),success:function(t){0===t.code?(e.closest(".form").prev().text(o).show(),e.closest(".form").remove()):alert(t.msg)},complete:function(){e.css("opacity",1).removeAttr("disabled")}})}};$(document).ready((function(){Breezemoon.init()}));