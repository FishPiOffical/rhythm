var Settings={submitIdentity:function(){let e={};e.type=$("#id-type").children("option:selected").val();let a=!1;switch(e.type){case"LGBT 群体认证":default:""===idCert&&(alert("上传资料不完整，请重新上传"),a=!0);break;case"00 后认证":""!==idCert&&""!==idId||(alert("上传资料不完整，请重新上传"),a=!0)}a||(e.idCert=idCert,e.idId=idId,$.ajax({url:Label.servePath+"/user/identify",type:"POST",data:JSON.stringify(e),success:function(e){alert(e.msg),location.reload()}}))},initIdentity:function(){$("#id-type").change((function(){let e=$(this).children("option:selected").val();Settings.changeIdentityType(e)})),Settings.changeIdentityType("企业入驻认证")},changeIdentityType:function(e){idCert="",idId="";let a="";switch(e){case"企业入驻认证":a+='<div class="fn-clear">申请企业认证，我们会通过私信联系您补交企业信息、官网、Logo等内容，以用来定制专属勋章，请耐心等待。</div><br>\n<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"         style="background-image:url(https://file.fishpi.cn/id/%E8%90%A5%E4%B8%9A%E6%89%A7%E7%85%A7%E5%89%AF%E6%9C%AC%E5%A4%8D%E5%8D%B0%E4%BB%B6.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"小姐姐认证":a+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E5%86%99%E7%A4%BE%E5%8C%BAID%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"LGBT 群体认证":a+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E8%BA%AB%E4%BB%BD%E8%AF%81%E6%98%8E.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"00 后认证":a+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E6%8C%81%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>',a+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-id"\n         onclick="$(\'#id-id-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E5%86%99%E7%A4%BE%E5%8C%BAID%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-id-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>'}$("#id-content").html(a),Settings.initUploadAvatar({id:"id-cert-upload",userId:"${currentUser.oId}",maxSize:"${imgMaxSize?c}"},(function(e){var a=e.result.key;$("#id-cert").css("background-image","url("+a+")").data("imageurl",a),idCert=a})),Settings.initUploadAvatar({id:"id-id-upload",userId:"${currentUser.oId}",maxSize:"${imgMaxSize?c}"},(function(e){var a=e.result.key;$("#id-id").css("background-image","url("+a+")").data("imageurl",a),idId=a}))},removeMFA:function(){$.ajax({url:Label.servePath+"/mfa/remove",type:"GET",cache:!1,success:function(e){0===e.code?(alert(e.msg),location.reload()):Util.alert(e.msg)}})},verifyMFA:function(){let e=$("#mfaVerifyCode").val();$.ajax({url:Label.servePath+"/mfa/verify?code="+e,type:"GET",cache:!1,success:function(e){0===e.code?(alert(e.msg),location.reload()):(Util.alert(e.msg),$("#mfaVerifyCode").val(""))}})},initMFA:function(){$.ajax({url:Label.servePath+"/mfa/enabled",type:"GET",cache:!1,success:function(e){0===e.code?($("#mfaCode").append('<label><svg><use xlink:href="#safe"></use></svg> 验证器已启用，保护中</label><br><br><br>'),$("#mfaCode").append("<p>    您已绑定两步验证器，账户安全等级高。<br>如需更换绑定设备，请解绑后重新绑定。</p>"),$("#mfaCode").append('<br><button class="fn-right" onclick="Settings.removeMFA()">解绑</button>')):($("#mfaCode").append('<label><svg><use xlink:href="#unsafe"></use></svg> 未在保护中</label><br><br><br>'),$("#mfaCode").append('<p>    两步验证可以极大增强您的账户安全性，<a href="https://fishpi.cn/article/1650648000379" target="_blank">使用指南</a><br>    为防止意外丢失，建议您备份二维码下方的手动输入代码。<br>    请使用两步验证器扫描二维码绑定 (推荐使用 Authenticator)</p>'),$.ajax({url:Label.servePath+"/mfa",type:"GET",cache:!1,success:function(e){0===e.code?($("#mfaCode").append("<br>"),$("#mfaCode").append("<img src='"+e.qrCodeLink+"'/>"),$("#mfaCode").append("<br>"),$("#mfaCode").append("<p>或手动输入代码："+e.secret+"</p>"),$("#mfaCode").append("<br>"),$("#mfaCode").append("<p>绑定成功后，请输入一次性密码用于验证，并点击绑定按钮：</p>"),$("#mfaCode").append('<input id="mfaVerifyCode" type="text" />'),$("#mfaCode").append("<br><br>"),$("#mfaCode").append('<button class="fn-right" onclick="Settings.verifyMFA()">绑定</button>')):$("#mfaCode").append("获取2FA信息失败，请联系管理员")}}))}})},initApiCode:function(){$.ajax({url:Label.servePath+"/getApiKeyInWeb",type:"GET",cache:!1,success:function(e){""!==e.apiKey&&($("#apiCode").append('<label><svg><use xlink:href="#safe"></use></svg> 请使用官方APP扫码以登录APP </label><br><br><br>'),$("#apiCode").append("<p>为了保护账号安全,请勿将本二维码以任何方式分享给他人,请勿在任何地点分享此二维码内容</p>"),$("#apiCode").append("<br>"),$("#apiCode").append("<img src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=login:"+e.apiKey+"'/>"))}})},remainCheckin:0,initBag:function(e){let a="",t=e;void 0!==t.checkin1day&&t.checkin1day>0&&(a+='<button style="margin:0 5px 5px 0" onclick="Settings.use1dayCheckinCard(\''+Label.csrfToken+"')\">单日免签卡 x"+t.checkin1day+"</button>"),void 0!==t.checkin2days&&t.checkin2days>0&&(a+='<button style="margin:0 5px 5px 0" onclick="Settings.use2dayCheckinCard(\''+Label.csrfToken+"')\">两天免签卡 x"+t.checkin2days+"</button>"),void 0!==t.nameCard&&t.nameCard>0&&(a+='<button style="margin:0 5px 5px 0" onclick="Settings.useNameCard(\''+Label.csrfToken+"')\">改名卡 x"+t.nameCard+"</button>"),void 0!==t.metalTicket&&t.metalTicket>0&&(a+='<button style="margin:0 5px 5px 0" onclick="alert(\'您已取得摸鱼派一周年纪念勋章领取权限，请静待系统公告\')">摸鱼派一周年纪念勋章领取券 x'+t.metalTicket+"</button>"),void 0!==t.patchCheckinCard&&t.patchCheckinCard>0&&(a+='<button style="margin:0 5px 5px 0" onclick="Settings.usePatchCheckinCard(\''+Label.csrfToken+"', "+t.patchStart+')">补签卡 x'+t.patchCheckinCard+"</button>"),void 0!==t.sysCheckinRemain&&t.sysCheckinRemain>0&&(a+='<br><div style="float: left;font-size: 12px;color: rgba(0,0,0,0.38);">免签卡生效中，剩余'+t.sysCheckinRemain+"天</div>",Settings.remainCheckin=t.sysCheckinRemain),""===a&&(a="你的背包和钱包一样，是空的。"),document.getElementById("bag").innerHTML=a},initMetal:function(e){let a="";if(void 0!==e.list)for(let t=0;t<e.list.length;t++){let i=e.list[t],s="";s=!0===i.enabled?'<button class="btn red" onclick="Settings.toggleMetal(\''+i.name+"', false)\">卸下</button>":'<button class="btn green" onclick="Settings.toggleMetal(\''+i.name+"', true)\">佩戴</button>",a+='<div class="fn__flex" style="justify-content: space-between; margin-bottom: 10px"><div> <label style="margin: 0 0 0 0">   <div><img src="'+Util.genMetal(i.name,i.attr)+'"/><br><span style="font-size: 12px">'+i.name+" ("+i.description+")</span></div> </label> </div> <div>"+s+"</div></div>"}""===a&&(a="鱼战士，你还没有任何勋章！"),document.getElementById("metal").innerHTML=a},toggleMetal:function(e,a){$.ajax({url:Label.servePath+"/admin/user/toggle-metal",method:"post",data:"name="+e+"&enabled="+a,async:!1,success:function(){location.reload()}})},useNameCard:function(e){var a=prompt("请输入要修改的用户名","");null===a||""===a?alert("您没有输入用户名，取消使用改名卡。"):$.ajax({url:Label.servePath+"/bag/nameCard",type:"POST",async:!1,headers:{csrfToken:e},data:JSON.stringify({userName:a}),success:function(e){alert(e.msg),location.reload()}})},usePatchCheckinCard:function(e,a){null==a?alert("您没有可以补签的记录！"):!0===confirm("补签卡仅适用于断签一天的情况！\n在使用补签卡后，你的签到记录将提前至日期："+a+"\n确定继续吗？")&&$.ajax({url:Label.servePath+"/bag/patchCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},use1dayCheckinCard:function(e){let a="使用单日免签卡后，明天的签到将由系统自动帮你完成，不需要登录摸鱼派。确定使用吗？";Settings.remainCheckin>0&&(a="您已经有生效中的免签卡，如继续使用时间将继续叠加，确认继续吗？"),!0===confirm(a)&&$.ajax({url:Label.servePath+"/bag/1dayCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},use2dayCheckinCard:function(e){let a="使用两天免签卡后，明天和后天的签到将由系统自动帮你完成，不需要登录摸鱼派。确定使用吗？";Settings.remainCheckin>0&&(a="您已经有生效中的免签卡，如继续使用时间将继续叠加，确认继续吗？"),!0===confirm(a)&&$.ajax({url:Label.servePath+"/bag/2dayCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},report:function(e){var a=$(e);a.attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/report",type:"POST",cache:!1,data:JSON.stringify({reportDataId:$("#reportDialog").data("id"),reportDataType:2,reportType:$("input[name=report]:checked").val(),reportMemo:$("#reportTextarea").val()}),complete:function(e){a.removeAttr("disabled").css("opacity","1"),0===e.responseJSON.code?(Util.alert(Label.reportSuccLabel),$("#reportTextarea").val(""),$("#reportDialog").dialog("close")):Util.alert(e.responseJSON.msg)}})},getPhoneCaptcha:function(e){$("#phoneGetBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/phone/vc",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userPhone:$("#phoneInput").val(),captcha:$("#phoneVerify").val()}),success:function(e){0===e.code&&($("#phoneInput").prop("disabled",!0),$("#phone_captch").hide(),$("#phoneCodePanel").show(),$("#phoneCode").show().focus(),$("#phoneSubmitBtn").show(),$("#phoneGetBtn").hide()),Util.alert(e.msg),$("#phoneGetBtn").removeAttr("disabled").css("opacity","1")},error:function(e){Util.alert(e.statusText)}})},updatePhone:function(e){$("#phoneSubmitBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/phone",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userPhone:$("#phoneInput").val(),captcha:$("#phoneCode").val()}),success:function(e){0===e.code?($("#phone_captch").show(),$("#phoneVerify").val(""),$("#phoneCodePanel").hide(),$("#phoneCode").val(""),$("#phoneSubmitBtn").hide(),$("#phoneGetBtn").show(),$("#phoneInput").prop("disabled",!1),$("#phone_captch img").click(),Util.alert(Label.updateSuccLabel)):(1===e.code&&($("#phone_captch").show(),$("#phoneVerify").val(""),$("#phoneCodePanel").hide(),$("#phoneSubmitBtn").hide(),$("#phoneGetBtn").show(),$("#phoneInput").prop("disabled",!1),$("#phone_captch img").click()),Util.alert(e.msg)),$("#phoneSubmitBtn").removeAttr("disabled").css("opacity","1")}})},getEmailCaptcha:function(e){$("#emailGetBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/email/vc",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userEmail:$("#emailInput").val(),captcha:$("#emailVerify").val()}),success:function(e){0===e.code&&($("#emailInput").prop("disabled",!0),$("#email_captch").hide(),$("#emailCodePanel").show(),$("#emailCode").show().focus(),$("#emailSubmitBtn").show(),$("#emailGetBtn").hide()),Util.alert(e.msg),$("#emailGetBtn").removeAttr("disabled").css("opacity","1")}})},updateEmail:function(e){$("#emailSubmitBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/email",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userEmail:$("#emailInput").val(),captcha:$("#emailCode").val()}),success:function(e){0===e.code?($("#email_captch").show(),$("#emailVerify").val(""),$("#emailCodePanel").hide(),$("#emailCode").val(""),$("#emailSubmitBtn").hide(),$("#emailGetBtn").show(),$("#emailInput").prop("disabled",!1),$("#email_captch img").click(),Util.alert(Label.updateSuccLabel)):(1===e.code&&($("#email_captch").show(),$("#emailVerify").val(""),$("#emailCodePanel").hide(),$("#emailSubmitBtn").hide(),$("#emailGetBtn").show(),$("#emailInput").prop("disabled",!1),$("#email_captch img").click()),Util.alert(e.msg)),$("#emailSubmitBtn").removeAttr("disabled").css("opacity","1")}})},homeScroll:function(){$(".nav-tabs").html($(".home-menu").html()),$(".nav").css({position:"fixed","box-shadow":"0 1px 2px rgba(0,0,0,.2)"}),$(".main").css("paddingTop","68px")},notiScroll:function(){var e=$("#side"),a=e.width(),t=1===$(".small-tips").closest(".module").length?109+$(".small-tips").closest(".module").height():89;$(".side.fn-none").height(e.height()),$(window).scroll((function(){$(window).scrollTop()>t?(e.css({position:"fixed",width:a+"px",top:0,right:$(".wrapper").css("margin-right")}),$(".side.fn-none").show(),$(".small-tips").closest(".module").hide()):(e.removeAttr("style"),$(".side.fn-none").hide(),$(".small-tips").closest(".module").show())}))},initUploadAvatar:function(e,a){$("#"+e.id).fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:parseInt(e.maxSize),multipart:!0,pasteZone:null,dropZone:null,url:Label.servePath+"/upload",paramName:"file[]",add:function(e,a){if(a.files[0].type.split("/")[1],window.File&&window.FileReader&&window.FileList&&window.Blob){var t=new FileReader;t.readAsArrayBuffer(a.files[0]),t.onload=function(e){var t=new Uint8Array(e.target.result.slice(0,11));isImage(t)?e.target.result.byteLength>20971520?Util.alert("图片过大 (最大限制 20M)"):a.submit():Util.alert("只允许上传图片!")}}else a.submit()},formData:function(e){return e.serializeArray()},submit:function(e,a){},done:function(e,t){var i={result:{key:t.result.data.succMap[Object.keys(t.result.data.succMap)[0]]}};a(i)},fail:function(e,a){Util.alert("Upload error: "+a.errorThrown)}}).on("fileuploadprocessalways",(function(e,a){var t=a.files[a.index];a.files.error&&t.error&&Util.alert(t.error)}))},exportPosts:function(){$.ajax({url:Label.servePath+"/export/posts",type:"POST",cache:!1,success:function(e,a){0===e.code?window.open(e.url):Util.alert("TBD: V, tip display it....")}})},changeGeoStatus:function(e){var a={userGeoStatus:$("#geoStatus").val()};$.ajax({url:Label.servePath+"/settings/geo/status",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(a),success:function(e,a){console.log(e)}})},pointTransfer:function(e){if(Validate.goValidate({target:$("#pointTransferTip"),data:[{target:$("#pointTransferUserName"),type:"string",max:256,msg:Label.invalidUserNameLabel},{target:$("#pointTransferAmount"),type:"string",max:50,msg:Label.amountNotEmpty}]})){var a={userName:$("#pointTransferUserName").val(),amount:$("#pointTransferAmount").val(),memo:$("#pointTransferMemo").val()};$.ajax({url:Label.servePath+"/point/transfer",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(a),beforeSend:function(){$("#pointTransferTip").removeClass("succ").removeClass("error").html("")},error:function(e,a,t){Util.alert(t)},success:function(e,a){0===e.code?($("#pointTransferTip").addClass("succ").removeClass("error").html("<ul><li>"+Label.transferSuccLabel+"</li></ul>"),$("#pointTransferUserName").val(""),$("#pointTransferAmount").val(""),$("#pointTransferMemo").val("")):$("#pointTransferTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointTransferTip").show(),setTimeout((function(){$("#pointTransferTip").hide()}),2e3)}})}},pointBuyInvitecode:function(e){$.ajax({url:Label.servePath+"/point/buy-invitecode",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify({}),beforeSend:function(){$("#pointBuyInvitecodeTip").removeClass("succ").removeClass("error").html("")},error:function(e,a,t){Util.alert(t)},success:function(e,a){0===e.code?$(".list ul").prepend('<li class="vditor-reset"><code>'+e.msg.split(" ")[0]+"</code>"+e.msg.substr(16)+"</li>"):$("#pointBuyInvitecodeTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointBuyInvitecodeTip").show()}})},queryInvitecode:function(e){var a={invitecode:$("#invitecode").val()};$.ajax({url:Label.servePath+"/invitecode/state",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(a),beforeSend:function(){$("#invitecodeStateTip").removeClass("succ").removeClass("error").html("")},error:function(e,a,t){Util.alert(t)},success:function(e,a){switch(e.code){case-1:case 0:case 2:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>");break;case 1:$("#invitecodeStateTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>");break;default:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}S,$("#invitecodeStateTip").show()}})},requestDeactive:function(e){confirm("请注意！这不是保存按钮！！！\n点击确定后，您的摸鱼派账号将会被永久停用，无法登录，账户信息将被部分抹除，您绑定的手机号需要一个月后才能在摸鱼派重新注册账号，确定继续吗？")&&confirm("亲爱的鱼油，再次向您确认！\n您的账号数据非常宝贵，如果对社区的发展有任何意见或建议，欢迎联系摸鱼派管理组。\n本次确认后，您的账户将被永久停用。")&&Settings.update("deactivate",e)},update:function(e,a){var t={};switch(e){case"profiles":t=this._validateProfiles();break;case"password":t=this._validatePassword();break;case"privacy":t={userArticleStatus:$("#userArticleStatus").prop("checked"),userCommentStatus:$("#userCommentStatus").prop("checked"),userFollowingUserStatus:$("#userFollowingUserStatus").prop("checked"),userFollowingTagStatus:$("#userFollowingTagStatus").prop("checked"),userFollowingArticleStatus:$("#userFollowingArticleStatus").prop("checked"),userWatchingArticleStatus:$("#userWatchingArticleStatus").prop("checked"),userFollowerStatus:$("#userFollowerStatus").prop("checked"),userBreezemoonStatus:$("#userBreezemoonStatus").prop("checked"),userPointStatus:$("#userPointStatus").prop("checked"),userOnlineStatus:$("#userOnlineStatus").prop("checked"),userJoinPointRank:$("#joinPointRank").prop("checked"),userJoinUsedPointRank:$("#joinUsedPointRank").prop("checked"),userUAStatus:$("#userUAStatus").prop("checked")};break;case"function":t={userListPageSize:$("#userListPageSize").val(),userIndexRedirectURL:$("#userIndexRedirectURL").val(),userCommentViewMode:$("#userCommentViewMode").val(),userAvatarViewMode:$("#userAvatarViewMode").val(),userListViewMode:$("#userListViewMode").val(),userNotifyStatus:$("#userNotifyStatus").prop("checked"),userSubMailStatus:$("#userSubMailStatus").prop("checked"),userKeyboardShortcutsStatus:$("#userKeyboardShortcutsStatus").prop("checked"),userReplyWatchArticleStatus:$("#userReplyWatchArticleStatus").prop("checked"),userForwardPageStatus:$("#userForwardPageStatus").prop("checked"),chatRoomPictureStatus:$("#chatRoomPictureStatus").prop("checked")};break;case"emotionList":t=this._validateEmotionList();break;case"i18n":t={userLanguage:$("#userLanguage").val(),userTimezone:$("#userTimezone").val()};break;case"username":t={userName:$("#newUsername").val()};break;case"system":let e="";void 0!==$("#userCardSettings").attr("bgUrl")&&(e=$("#userCardSettings").attr("bgUrl"));let a="https://fishpi.cn/images/favicon.png?"+Label.staticResourceVersion;void 0!==$("#iconURL").data("imageurl")&&""!==$("#iconURL").data("imageurl")&&(a=$("#iconURL").data("imageurl")),t={systemTitle:$("#newSystemTitle").val(),cardBg:e,onlineTimeUnit:$("#onlineTimeUnit").val(),showSideAd:$("#showSideAd").prop("checked"),showTopAd:$("#showTopAd").prop("checked"),iconURL:a};break;case"deactivate":break;default:console.log("update settings has no type")}if(!t)return!1;$.ajax({url:Label.servePath+"/settings/"+e,type:"POST",headers:{csrfToken:a},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#"+e.replace(/\//g,"")+"Tip").removeClass("succ").removeClass("error").html("")},error:function(e,a,t){Util.alert(t)},success:function(a,i){if(0===a.code){if($("#"+e.replace(/\//g,"")+"Tip").addClass("succ").removeClass("error").html("<ul><li>"+Label.updateSuccLabel+"</li></ul>").show(),"profiles"===e)return $("#userNicknameDom").text(t.userNickname),$("#userTagsDom").text(t.userTags),$("#userURLDom").text(t.userURL).attr("href",t.userURL),void $("#userIntroDom").text(t.userIntro)}else $("#"+e.replace(/\//g,"")+"Tip").addClass("error").removeClass("succ").html("<ul><li>"+a.msg+"</li></ul>");$("#"+e.replace(/\//g,"")+"Tip").show(),setTimeout((function(){$("#"+e.replace(/\//g,"")+"Tip").hide(),"i18n"===e&&window.location.reload(),"deactivate"===e&&(window.location.href=Label.servePath)}),5e3)}})},updateAvatar:function(e){var a={userAvatarURL:$("#avatarURL").data("imageurl")};$.ajax({url:Label.servePath+"/settings/avatar",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(a),beforeSend:function(){},error:function(e,a,t){Util.alert(t)},success:function(e,t){0===e.code&&$("#avatarURLDom, .user-nav .avatar-small").attr("style","background-image:url("+a.userAvatarURL+")")}})},_validateProfiles:function(){return!!Validate.goValidate({target:$("#profilesTip"),data:[{target:$("#userNickname"),type:"string",min:0,max:20,msg:Label.invalidUserNicknameLabel},{target:$("#userTags"),type:"string",min:0,max:255,msg:Label.tagsErrorLabel},{target:$("#userURL"),type:"string",min:0,max:255,msg:Label.invalidUserURLLabel},{target:$("#userIntro"),type:"string",min:0,max:255,msg:Label.invalidUserIntroLabel},{target:$("#userMbti"),type:"string",min:0,max:255,msg:"错误的MBTI长度"}]})&&{userNickname:$("#userNickname").val().replace(/(^\s*)|(\s*$)/g,""),userTags:$("#userTags").val().replace(/(^\s*)|(\s*$)/g,""),userURL:$("#userURL").val().replace(/(^\s*)|(\s*$)/g,""),userIntro:$("#userIntro").val().replace(/(^\s*)|(\s*$)/g,""),mbti:$("#userMbti").val().replace(/(^\s*)|(\s*$)/g,"")}},_validatePassword:function(){var e=$("#pwdOld").val(),a=$("#pwdNew").val();if(Validate.goValidate({target:$("#passwordTip"),data:[{target:$("#pwdNew"),type:"password",msg:Label.invalidPasswordLabel},{target:$("#pwdRepeat"),type:"password",oranginal:$("#pwdNew"),msg:Label.confirmPwdErrorLabel}]})){if(a!==$("#pwdRepeat").val())return!1;var t={};return t.userPassword=calcMD5(e),t.userNewPassword=calcMD5(a),t}return!1},_validateEmotionList:function(){return{emotions:$("#emotionList").val()}},makeAllNotificationsRead:function(){$.ajax({url:Label.servePath+"/notifications/all-read",type:"GET",cache:!1,success:function(e,a){0===e.code&&window.location.reload()}})},removeNotifications:function(e){return $.ajax({url:Label.servePath+"/notifications/remove/"+e,type:"GET",cache:!1,success:function(e){0===e.code&&location.reload()}}),!1},initFunction:function(){$("#emojiGrid img").click((function(){var e=$(this).attr("alt");-1===$("#emotionList").val().split(",").indexOf(e)&&(""!==$("#emotionList").val()?$("#emotionList").val($("#emotionList").val()+","+e):$("#emotionList").val(e))}))},initHome:function(){"commentsAnonymous"!==Label.type&&"comments"!==Label.type||(Util.parseHljs(),Util.parseMarkdown()),$("#reportDialog").dialog({width:$(window).width()>500?500:$(window).width()-50,height:365,modal:!0,hideFooter:!0}),$.ajax({url:Label.servePath+"/user/"+Label.userName+"/metal",async:!0,method:"get",success:function(e){let a=e.data.list;if(void 0!==a)for(let e=0;e<a.length;e++){let t=a[e];$("#metal").append("<img title='"+t.description+"' src='"+Util.genMetal(t.name,t.attr)+"'/>")}}}),"mobile"!==$.ua.device.type&&(Settings.homeScroll(),$.pjax({selector:"a",container:"#home-pjax-container",show:"",cache:!1,storage:!0,titleSuffix:"",filter:function(e){return 0>e.indexOf(Label.servePath+"/member/"+Label.userName)},callback:function(e){switch(e.type){case"success":case"cache":switch($(".home-menu a").removeClass("current"),Util.listenUserCard(),location.pathname){case"/member/"+Label.userName:case"/member/"+Label.userName+"/comments":Util.parseHljs(),Util.parseMarkdown();case"/member/"+Label.userName+"/articles/anonymous":case"/member/"+Label.userName+"/comments/anonymous":Util.parseHljs(),Util.parseMarkdown(),$(".home-menu a:eq(0)").addClass("current");break;case"/member/"+Label.userName+"/watching/articles":case"/member/"+Label.userName+"/following/users":case"/member/"+Label.userName+"/following/tags":case"/member/"+Label.userName+"/following/articles":case"/member/"+Label.userName+"/followers":$(".home-menu a:eq(1)").addClass("current");break;case"/member/"+Label.userName+"/breezemoons":$(".home-menu a:eq(1)").addClass("current"),Breezemoon.init();break;case"/member/"+Label.userName+"/points":$(".home-menu a:eq(2)").addClass("current")}}$(".nav-tabs").html($(".home-menu").html()),Util.parseMarkdown(),Util.parseHljs()}}),NProgress.configure({showSpinner:!1}),$("#home-pjax-container").bind("pjax.start",(function(){NProgress.start()})),$("#home-pjax-container").bind("pjax.end",(function(){NProgress.done()})))}};