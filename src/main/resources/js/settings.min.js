var Settings={submitIdentity:function(){let e={};e.type=$("#id-type").children("option:selected").val();let t=!1;switch(e.type){case"LGBT ç¾¤ä½“è®¤è¯":default:""===idCert&&(alert("ä¸Šä¼ èµ„æ–™ä¸å®Œæ•´ï¼Œè¯·é‡æ–°ä¸Šä¼ "),t=!0);break;case"00 åè®¤è¯":""!==idCert&&""!==idId||(alert("ä¸Šä¼ èµ„æ–™ä¸å®Œæ•´ï¼Œè¯·é‡æ–°ä¸Šä¼ "),t=!0)}t||(e.idCert=idCert,e.idId=idId,$.ajax({url:Label.servePath+"/user/identify",type:"POST",data:JSON.stringify(e),success:function(e){alert(e.msg),location.reload()}}))},initIdentity:function(){$("#id-type").change((function(){let e=$(this).children("option:selected").val();Settings.changeIdentityType(e)})),Settings.changeIdentityType("ä¼ä¸šå…¥é©»è®¤è¯")},changeIdentityType:function(e){idCert="",idId="";let t="";switch(e){case"ä¼ä¸šå…¥é©»è®¤è¯":t+='<div class="fn-clear">ç”³è¯·ä¼ä¸šè®¤è¯ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ç§ä¿¡è”ç³»æ‚¨è¡¥äº¤ä¼ä¸šä¿¡æ¯ã€å®˜ç½‘ã€Logoç­‰å†…å®¹ï¼Œä»¥ç”¨æ¥å®šåˆ¶ä¸“å±å‹‹ç« ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚</div><br>\n<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"         style="background-image:url(https://file.fishpi.cn/id/%E8%90%A5%E4%B8%9A%E6%89%A7%E7%85%A7%E5%89%AF%E6%9C%AC%E5%A4%8D%E5%8D%B0%E4%BB%B6.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"å°å§å§è®¤è¯":t+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E5%86%99%E7%A4%BE%E5%8C%BAID%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"LGBT ç¾¤ä½“è®¤è¯":t+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E8%BA%AB%E4%BB%BD%E8%AF%81%E6%98%8E.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>';break;case"00 åè®¤è¯":t+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-cert"\n         onclick="$(\'#id-cert-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E6%8C%81%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-cert-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>',t+='<div class="fn-clear" style="margin: 0 30px 20px 0; display: inline-block">\n    <div class="avatar-big" id="id-id"\n         onclick="$(\'#id-id-upload input\').click()"\n         style="background-image:url(https://file.fishpi.cn/id/%E6%89%8B%E5%86%99%E7%A4%BE%E5%8C%BAID%E8%87%AA%E6%8B%8D%E7%85%A7.png)"></div>\n</div>\n<form id="id-id-upload" style="display: none" method="POST" enctype="multipart/form-data">\n        <input type="file" name="file">\n</form>'}$("#id-content").html(t),Settings.initUploadAvatar({id:"id-cert-upload",userId:"${currentUser.oId}",maxSize:"${imgMaxSize?c}"},(function(e){var t=e.result.key;$("#id-cert").css("background-image","url("+t+")").data("imageurl",t),idCert=t})),Settings.initUploadAvatar({id:"id-id-upload",userId:"${currentUser.oId}",maxSize:"${imgMaxSize?c}"},(function(e){var t=e.result.key;$("#id-id").css("background-image","url("+t+")").data("imageurl",t),idId=t}))},removeMFA:function(){$.ajax({url:Label.servePath+"/mfa/remove",type:"GET",cache:!1,success:function(e){0===e.code?(alert(e.msg),location.reload()):Util.notice("warning",2e3,e.msg)}})},verifyMFA:function(){let e=$("#mfaVerifyCode").val();$.ajax({url:Label.servePath+"/mfa/verify?code="+e,type:"GET",cache:!1,success:function(e){0===e.code?(alert(e.msg),location.reload()):(Util.notice("warning",2e3,e.msg),$("#mfaVerifyCode").val(""))}})},initMFA:function(){$.ajax({url:Label.servePath+"/mfa/enabled",type:"GET",cache:!1,success:function(e){0===e.code?($("#mfaCode").append('<label><svg><use xlink:href="#safe"></use></svg> éªŒè¯å™¨å·²å¯ç”¨ï¼Œä¿æŠ¤ä¸­</label><br><br><br>'),$("#mfaCode").append("<p>    æ‚¨å·²ç»‘å®šä¸¤æ­¥éªŒè¯å™¨ï¼Œè´¦æˆ·å®‰å…¨ç­‰çº§é«˜ã€‚<br>å¦‚éœ€æ›´æ¢ç»‘å®šè®¾å¤‡ï¼Œè¯·è§£ç»‘åé‡æ–°ç»‘å®šã€‚</p>"),$("#mfaCode").append('<br><button class="fn-right" onclick="Settings.removeMFA()">è§£ç»‘</button>')):($("#mfaCode").append('<label><svg><use xlink:href="#unsafe"></use></svg> æœªåœ¨ä¿æŠ¤ä¸­</label><br><br><br>'),$("#mfaCode").append('<p>    ä¸¤æ­¥éªŒè¯å¯ä»¥æå¤§å¢å¼ºæ‚¨çš„è´¦æˆ·å®‰å…¨æ€§ï¼Œ<a href="https://fishpi.cn/article/1650648000379" target="_blank">ä½¿ç”¨æŒ‡å—</a><br>    ä¸ºé˜²æ­¢æ„å¤–ä¸¢å¤±ï¼Œå»ºè®®æ‚¨å¤‡ä»½äºŒç»´ç ä¸‹æ–¹çš„æ‰‹åŠ¨è¾“å…¥ä»£ç ã€‚<br>    è¯·ä½¿ç”¨ä¸¤æ­¥éªŒè¯å™¨æ‰«æäºŒç»´ç ç»‘å®š (æ¨èä½¿ç”¨ Authenticator)</p>'),$.ajax({url:Label.servePath+"/mfa",type:"GET",cache:!1,success:function(e){0===e.code?($("#mfaCode").append("<br>"),$("#mfaCode").append("<img src='"+e.qrCodeLink+"'/>"),$("#mfaCode").append("<br>"),$("#mfaCode").append("<p>æˆ–æ‰‹åŠ¨è¾“å…¥ä»£ç ï¼š"+e.secret+"</p>"),$("#mfaCode").append("<br>"),$("#mfaCode").append("<p>ç»‘å®šæˆåŠŸåï¼Œè¯·è¾“å…¥ä¸€æ¬¡æ€§å¯†ç ç”¨äºéªŒè¯ï¼Œå¹¶ç‚¹å‡»ç»‘å®šæŒ‰é’®ï¼š</p>"),$("#mfaCode").append('<input id="mfaVerifyCode" type="text" />'),$("#mfaCode").append("<br><br>"),$("#mfaCode").append('<button class="fn-right" onclick="Settings.verifyMFA()">ç»‘å®š</button>')):$("#mfaCode").append("è·å–2FAä¿¡æ¯å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜")}}))}})},initApiCode:function(){$.ajax({url:Label.servePath+"/getApiKeyInWeb",type:"GET",cache:!1,success:function(e){""!==e.apiKey&&($("#apiCode").append('<label><svg><use xlink:href="#safe"></use></svg> è¯·ä½¿ç”¨å®˜æ–¹APPæ‰«ç ä»¥ç™»å½•APP </label><br><br><br>'),$("#apiCode").append("<p>ä¸ºäº†ä¿æŠ¤è´¦å·å®‰å…¨,è¯·å‹¿å°†æœ¬äºŒç»´ç ä»¥ä»»ä½•æ–¹å¼åˆ†äº«ç»™ä»–äºº,è¯·å‹¿åœ¨ä»»ä½•åœ°ç‚¹åˆ†äº«æ­¤äºŒç»´ç å†…å®¹</p>"),$("#apiCode").append("<br>"),$("#apiCode").append("<img src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=login:"+e.apiKey+"'/>"))}})},remainCheckin:0,initBag:function(e){let t="",i=e;void 0!==i.checkin1day&&i.checkin1day>0&&(t+='<button style="margin:0 5px 5px 0" onclick="Settings.use1dayCheckinCard(\''+Label.csrfToken+"')\">å•æ—¥å…ç­¾å¡ x"+i.checkin1day+"</button>"),void 0!==i.checkin2days&&i.checkin2days>0&&(t+='<button style="margin:0 5px 5px 0" onclick="Settings.use2dayCheckinCard(\''+Label.csrfToken+"')\">ä¸¤å¤©å…ç­¾å¡ x"+i.checkin2days+"</button>"),void 0!==i.nameCard&&i.nameCard>0&&(t+='<button style="margin:0 5px 5px 0" onclick="Settings.useNameCard(\''+Label.csrfToken+"')\">æ”¹åå¡ x"+i.nameCard+"</button>"),void 0!==i.metalTicket&&i.metalTicket>0&&(t+='<button style="margin:0 5px 5px 0" onclick="alert(\'æ‚¨å·²å–å¾—æ‘¸é±¼æ´¾ä¸€å‘¨å¹´çºªå¿µå‹‹ç« é¢†å–æƒé™ï¼Œè¯·é™å¾…ç³»ç»Ÿå…¬å‘Š\')">æ‘¸é±¼æ´¾ä¸€å‘¨å¹´çºªå¿µå‹‹ç« é¢†å–åˆ¸ x'+i.metalTicket+"</button>"),void 0!==i.patchCheckinCard&&i.patchCheckinCard>0&&(t+='<button style="margin:0 5px 5px 0" onclick="Settings.usePatchCheckinCard(\''+Label.csrfToken+"', "+i.patchStart+')">è¡¥ç­¾å¡ x'+i.patchCheckinCard+"</button>"),void 0!==i.sysCheckinRemain&&i.sysCheckinRemain>0&&(t+='<br><div style="float: left;font-size: 12px;color: rgba(0,0,0,0.38);">å…ç­¾å¡ç”Ÿæ•ˆä¸­ï¼Œå‰©ä½™'+i.sysCheckinRemain+"å¤©</div>",Settings.remainCheckin=i.sysCheckinRemain),""===t&&(t="ä½ çš„èƒŒåŒ…å’Œé’±åŒ…ä¸€æ ·ï¼Œæ˜¯ç©ºçš„ã€‚"),document.getElementById("bag").innerHTML=t},initMetal:function(){Settings.loadMyMedals()},loadMyMedals:function(){$.ajax({url:Label.servePath+"/api/medal/my/list",type:"POST",cache:!1,data:JSON.stringify({}),contentType:"application/json;charset=UTF-8",success:function(e){if(e&&0===e.code){var t=e.data||[];Settings.renderMyMedals(t)}else document.getElementById("metal").innerHTML="åŠ è½½å‹‹ç« å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚"},error:function(){document.getElementById("metal").innerHTML="åŠ è½½å‹‹ç« å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚"}})},_formatExpireTime:function(e){if(!e||e<=0)return"æ°¸ä¹…";try{var t=new Date(e);return isNaN(t.getTime())?String(e):t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)}catch(t){return String(e)}},renderMyMedals:function(e){var t="";if(e&&e.length>0){e.sort((function(e,t){return("number"==typeof e.display_order?e.display_order:0)-("number"==typeof t.display_order?t.display_order:0)}));for(var i=0;i<e.length;i++){var a,o=e[i],n=o.medal_id||o.medalId||"",r=o.medal_name||o.name||"",s=o.medal_description||o.description||"",l=o.medal_type||o.type||"æ™®é€š",c="boolean"!=typeof o.display||o.display,d=("number"==typeof o.display_order&&o.display_order,o.expire_time||o.expireTime||0),p=Settings._formatExpireTime(d),u=Util.renderMedalType(l);a=c?'<button class="btn red" onclick="Settings.toggleMyMedalDisplay(\''+n+"', false)\">å¸ä¸‹</button>":'<button class="btn green" onclick="Settings.toggleMyMedalDisplay(\''+n+"', true)\">ä½©æˆ´</button>";var m='<button class="btn btn-secondary" style="margin-left:4px" onclick="Settings.changeMyMedalOrder(\''+n+'\', \'up\')">â†‘</button><button class="btn btn-secondary" style="margin-left:4px" onclick="Settings.changeMyMedalOrder(\''+n+"', 'down')\">â†“</button>";t+='<div class="fn__flex" style="justify-content: space-between; align-items: center; margin-bottom: 10px"><div><label style="margin: 0"><div><img src="'+Util.genMetal(n)+'" style="border-radius:4px;object-fit:cover;"/><br><span style="font-size: 12px;">'+r+' <span style="font-size:11px;margin-left:4px;'+u+'">['+l+"]</span>"+(s?" ("+s+")":"")+'</span><br><span style="font-size: 11px; color: rgba(0,0,0,0.54);">è¿‡æœŸæ—¶é—´ï¼š'+p+'</span></div></label></div><div style="text-align:right; display:flex; flex-direction:column; align-items:flex-end;"><div style="display:flex; align-items:center; justify-content:flex-end;">'+a+m+"</div></div></div>"}}""===t&&(t="é±¼æˆ˜å£«ï¼Œä½ è¿˜æ²¡æœ‰ä»»ä½•å‹‹ç« ï¼"),document.getElementById("metal").innerHTML=t},loadUserMedals:function(e,t){if(document.getElementById("metal")){var i={};if(e)i.userId=e;else{if(!t)return;i.userName=t}$.ajax({url:Label.servePath+"/api/medal/user/list",type:"POST",cache:!1,data:JSON.stringify(i),contentType:"application/json;charset=UTF-8",success:function(e){if(e&&0===e.code){var t=e.data||[];Settings.renderUserMedals(t)}},error:function(){}})}},renderUserMedals:function(e){var t=document.getElementById("metal");if(t)if(e&&0!==e.length){e.sort((function(e,t){return("number"==typeof e.display_order?e.display_order:0)-("number"==typeof t.display_order?t.display_order:0)}));for(var i="",a=0;a<e.length;a++){var o=e[a];i+=Util.genMedalTooltips("<img src='"+Util.genMetal(o.medal_id)+"'/>",o.medal_type,o.medal_name+" - "+o.medal_description)}t.innerHTML=i}else t.innerHTML=""},toggleMyMedalDisplay:function(e,t){$.ajax({url:Label.servePath+"/api/medal/my/display",type:"POST",cache:!1,data:JSON.stringify({medalId:e,display:t}),contentType:"application/json;charset=UTF-8",success:function(e){e&&0===e.code?Settings.loadMyMedals():Util.notice("warning",2e3,"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•")},error:function(){Util.notice("warning",2e3,"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•")}})},changeMyMedalOrder:function(e,t){"up"!==t&&"down"!==t||$.ajax({url:Label.servePath+"/api/medal/my/reorder",type:"POST",cache:!1,data:JSON.stringify({medalId:e,direction:t}),contentType:"application/json;charset=UTF-8",success:function(e){e&&0===e.code?Settings.loadMyMedals():Util.alert("æ’åºå¤±è´¥ï¼Œè¯·ç¨åå†è¯•")},error:function(){Util.alert("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•")}})},useNameCard:function(e){var t=prompt("è¯·è¾“å…¥è¦ä¿®æ”¹çš„ç”¨æˆ·å","");null===t||""===t?alert("æ‚¨æ²¡æœ‰è¾“å…¥ç”¨æˆ·åï¼Œå–æ¶ˆä½¿ç”¨æ”¹åå¡ã€‚"):$.ajax({url:Label.servePath+"/bag/nameCard",type:"POST",async:!1,headers:{csrfToken:e},data:JSON.stringify({userName:t}),success:function(e){alert(e.msg),location.reload()}})},usePatchCheckinCard:function(e,t){null==t?alert("æ‚¨æ²¡æœ‰å¯ä»¥è¡¥ç­¾çš„è®°å½•ï¼"):!0===confirm("è¡¥ç­¾å¡ä»…é€‚ç”¨äºæ–­ç­¾ä¸€å¤©çš„æƒ…å†µï¼\nåœ¨ä½¿ç”¨è¡¥ç­¾å¡åï¼Œä½ çš„ç­¾åˆ°è®°å½•å°†æå‰è‡³æ—¥æœŸï¼š"+t+"\nç¡®å®šç»§ç»­å—ï¼Ÿ")&&$.ajax({url:Label.servePath+"/bag/patchCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},use1dayCheckinCard:function(e){let t="ä½¿ç”¨å•æ—¥å…ç­¾å¡åï¼Œæ˜å¤©çš„ç­¾åˆ°å°†ç”±ç³»ç»Ÿè‡ªåŠ¨å¸®ä½ å®Œæˆï¼Œä¸éœ€è¦ç™»å½•æ‘¸é±¼æ´¾ã€‚ç¡®å®šä½¿ç”¨å—ï¼Ÿ";Settings.remainCheckin>0&&(t="æ‚¨å·²ç»æœ‰ç”Ÿæ•ˆä¸­çš„å…ç­¾å¡ï¼Œå¦‚ç»§ç»­ä½¿ç”¨æ—¶é—´å°†ç»§ç»­å åŠ ï¼Œç¡®è®¤ç»§ç»­å—ï¼Ÿ"),!0===confirm(t)&&$.ajax({url:Label.servePath+"/bag/1dayCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},use2dayCheckinCard:function(e){let t="ä½¿ç”¨ä¸¤å¤©å…ç­¾å¡åï¼Œæ˜å¤©å’Œåå¤©çš„ç­¾åˆ°å°†ç”±ç³»ç»Ÿè‡ªåŠ¨å¸®ä½ å®Œæˆï¼Œä¸éœ€è¦ç™»å½•æ‘¸é±¼æ´¾ã€‚ç¡®å®šä½¿ç”¨å—ï¼Ÿ";Settings.remainCheckin>0&&(t="æ‚¨å·²ç»æœ‰ç”Ÿæ•ˆä¸­çš„å…ç­¾å¡ï¼Œå¦‚ç»§ç»­ä½¿ç”¨æ—¶é—´å°†ç»§ç»­å åŠ ï¼Œç¡®è®¤ç»§ç»­å—ï¼Ÿ"),!0===confirm(t)&&$.ajax({url:Label.servePath+"/bag/2dayCheckin",type:"GET",async:!1,headers:{csrfToken:e},success:function(e){alert(e.msg),location.reload()}})},report:function(e){var t=$(e);t.attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/report",type:"POST",cache:!1,data:JSON.stringify({reportDataId:$("#reportDialog").data("id"),reportDataType:2,reportType:$("input[name=report]:checked").val(),reportMemo:$("#reportTextarea").val()}),complete:function(e){t.removeAttr("disabled").css("opacity","1"),0===e.responseJSON.code?(Util.alert(Label.reportSuccLabel),$("#reportTextarea").val(""),$("#reportDialog").dialog("close")):Util.alert(e.responseJSON.msg)}})},getPhoneCaptcha:function(e,t){$("#phoneGetBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/phone/vc",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userPhone:$("#phoneInput").val(),captcha:t}),success:function(e){0===e.code&&($("#phoneInput").prop("disabled",!0),$("#phone_captch").hide(),$("#phoneCodePanel").show(),$("#phoneCode").show().focus(),$("#phoneSubmitBtn").show(),$("#phoneGetBtn").hide()),Util.alert(e.msg),$("#phoneGetBtn").removeAttr("disabled").css("opacity","1")},error:function(e){Util.alert(e.statusText)}})},updatePhone:function(e){$("#phoneSubmitBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/phone",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userPhone:$("#phoneInput").val(),captcha:$("#phoneCode").val()}),success:function(e){0===e.code?($("#phone_captch").show(),$("#phoneVerify").val(""),$("#phoneCodePanel").hide(),$("#phoneCode").val(""),$("#phoneSubmitBtn").hide(),$("#phoneGetBtn").show(),$("#phoneInput").prop("disabled",!1),$("#phone_captch img").click(),Util.alert(Label.updateSuccLabel)):(1===e.code&&($("#phone_captch").show(),$("#phoneVerify").val(""),$("#phoneCodePanel").hide(),$("#phoneSubmitBtn").hide(),$("#phoneGetBtn").show(),$("#phoneInput").prop("disabled",!1),$("#phone_captch img").click()),Util.alert(e.msg)),$("#phoneSubmitBtn").removeAttr("disabled").css("opacity","1")}})},getEmailCaptcha:function(e){$("#emailGetBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/email/vc",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userEmail:$("#emailInput").val(),captcha:$("#emailVerify").val()}),success:function(e){0===e.code&&($("#emailInput").prop("disabled",!0),$("#email_captch").hide(),$("#emailCodePanel").show(),$("#emailCode").show().focus(),$("#emailSubmitBtn").show(),$("#emailGetBtn").hide()),Util.alert(e.msg),$("#emailGetBtn").removeAttr("disabled").css("opacity","1")}})},updateEmail:function(e){$("#emailSubmitBtn").attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/settings/email",type:"POST",headers:{csrfToken:e},data:JSON.stringify({userEmail:$("#emailInput").val(),captcha:$("#emailCode").val()}),success:function(e){0===e.code?($("#email_captch").show(),$("#emailVerify").val(""),$("#emailCodePanel").hide(),$("#emailCode").val(""),$("#emailSubmitBtn").hide(),$("#emailGetBtn").show(),$("#emailInput").prop("disabled",!1),$("#email_captch img").click(),Util.alert(Label.updateSuccLabel)):(1===e.code&&($("#email_captch").show(),$("#emailVerify").val(""),$("#emailCodePanel").hide(),$("#emailSubmitBtn").hide(),$("#emailGetBtn").show(),$("#emailInput").prop("disabled",!1),$("#email_captch img").click()),Util.alert(e.msg)),$("#emailSubmitBtn").removeAttr("disabled").css("opacity","1")}})},homeScroll:function(){$(".nav-tabs").html($(".home-menu").html()),$(".nav").css({position:"fixed","box-shadow":"0 1px 2px rgba(0,0,0,.2)"}),$(".main").css("paddingTop","68px")},notiScroll:function(){var e=$("#side"),t=e.width(),i=1===$(".small-tips").closest(".module").length?109+$(".small-tips").closest(".module").height():89;$(".side.fn-none").height(e.height()),$(window).scroll((function(){$(window).scrollTop()>i?(e.css({position:"fixed",width:t+"px",top:0,right:$(".wrapper").css("margin-right")}),$(".side.fn-none").show(),$(".small-tips").closest(".module").hide()):(e.removeAttr("style"),$(".side.fn-none").hide(),$(".small-tips").closest(".module").show())}))},initUploadAvatar:function(e,t){$("#"+e.id).fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:parseInt(e.maxSize),multipart:!0,pasteZone:null,dropZone:null,url:Label.servePath+"/upload",paramName:"file[]",add:function(e,t){if(t.files[0].type.split("/")[1],window.File&&window.FileReader&&window.FileList&&window.Blob){var i=new FileReader;i.readAsArrayBuffer(t.files[0]),i.onload=function(e){var i=new Uint8Array(e.target.result.slice(0,11));isImage(i)?e.target.result.byteLength>20971520?Util.alert("å›¾ç‰‡è¿‡å¤§ (æœ€å¤§é™åˆ¶ 20M)"):t.submit():Util.alert("åªå…è®¸ä¸Šä¼ å›¾ç‰‡!")}}else t.submit()},formData:function(e){return e.serializeArray()},submit:function(e,t){},done:function(e,i){var a={result:{key:i.result.data.succMap[Object.keys(i.result.data.succMap)[0]]}};t(a)},fail:function(e,t){Util.alert("Upload error: "+t.errorThrown)}}).on("fileuploadprocessalways",(function(e,t){var i=t.files[t.index];t.files.error&&i.error&&Util.alert(i.error)}))},exportPosts:function(){$.ajax({url:Label.servePath+"/export/posts",type:"POST",cache:!1,success:function(e,t){0===e.code?window.open(e.url):Util.alert("TBD: V, tip display it....")}})},changeGeoStatus:function(e){var t={userGeoStatus:$("#geoStatus").val()};$.ajax({url:Label.servePath+"/settings/geo/status",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),success:function(e,t){console.log(e)}})},pointTransfer:function(e){if(Validate.goValidate({target:$("#pointTransferTip"),data:[{target:$("#pointTransferUserName"),type:"string",max:256,msg:Label.invalidUserNameLabel},{target:$("#pointTransferAmount"),type:"string",max:50,msg:Label.amountNotEmpty}]})){var t={userName:$("#pointTransferUserName").val(),amount:$("#pointTransferAmount").val(),memo:$("#pointTransferMemo").val()};$.ajax({url:Label.servePath+"/point/transfer",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#pointTransferTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,i){Util.alert(i)},success:function(e,t){0===e.code?($("#pointTransferTip").addClass("succ").removeClass("error").html("<ul><li>"+Label.transferSuccLabel+"</li></ul>"),$("#pointTransferUserName").val(""),$("#pointTransferAmount").val(""),$("#pointTransferMemo").val("")):$("#pointTransferTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointTransferTip").show(),setTimeout((function(){$("#pointTransferTip").hide()}),2e3)}})}},pointBuyInvitecode:function(e){$.ajax({url:Label.servePath+"/point/buy-invitecode",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify({}),beforeSend:function(){$("#pointBuyInvitecodeTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,i){Util.alert(i)},success:function(e,t){0===e.code?$(".list ul").prepend('<li class="vditor-reset"><code>'+e.msg.split(" ")[0]+"</code>"+e.msg.substr(16)+"</li>"):$("#pointBuyInvitecodeTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointBuyInvitecodeTip").show()}})},queryInvitecode:function(e){var t={invitecode:$("#invitecode").val()};$.ajax({url:Label.servePath+"/invitecode/state",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#invitecodeStateTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,i){Util.alert(i)},success:function(e,t){switch(e.code){case-1:case 0:case 2:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>");break;case 1:$("#invitecodeStateTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>");break;default:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}S,$("#invitecodeStateTip").show()}})},requestDeactive:function(e){confirm("è¯·æ³¨æ„ï¼è¿™ä¸æ˜¯ä¿å­˜æŒ‰é’®ï¼ï¼ï¼\nç‚¹å‡»ç¡®å®šåï¼Œæ‚¨çš„æ‘¸é±¼æ´¾è´¦å·å°†ä¼šè¢«æ°¸ä¹…åœç”¨ï¼Œæ— æ³•ç™»å½•ï¼Œè´¦æˆ·ä¿¡æ¯å°†è¢«éƒ¨åˆ†æŠ¹é™¤ï¼Œæ‚¨ç»‘å®šçš„æ‰‹æœºå·éœ€è¦ä¸€ä¸ªæœˆåæ‰èƒ½åœ¨æ‘¸é±¼æ´¾é‡æ–°æ³¨å†Œè´¦å·ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ")&&confirm("äº²çˆ±çš„é±¼æ²¹ï¼Œå†æ¬¡å‘æ‚¨ç¡®è®¤ï¼\næ‚¨çš„è´¦å·æ•°æ®éå¸¸å®è´µï¼Œå¦‚æœå¯¹ç¤¾åŒºçš„å‘å±•æœ‰ä»»ä½•æ„è§æˆ–å»ºè®®ï¼Œæ¬¢è¿è”ç³»æ‘¸é±¼æ´¾ç®¡ç†ç»„ã€‚\næœ¬æ¬¡ç¡®è®¤åï¼Œæ‚¨çš„è´¦æˆ·å°†è¢«æ°¸ä¹…åœç”¨ã€‚")&&Settings.update("deactivate",e)},update:function(e,t){var i={};switch(e){case"profiles":i=this._validateProfiles();break;case"password":i=this._validatePassword();break;case"privacy":i={userArticleStatus:$("#userArticleStatus").prop("checked"),userCommentStatus:$("#userCommentStatus").prop("checked"),userFollowingUserStatus:$("#userFollowingUserStatus").prop("checked"),userFollowingTagStatus:$("#userFollowingTagStatus").prop("checked"),userFollowingArticleStatus:$("#userFollowingArticleStatus").prop("checked"),userWatchingArticleStatus:$("#userWatchingArticleStatus").prop("checked"),userFollowerStatus:$("#userFollowerStatus").prop("checked"),userBreezemoonStatus:$("#userBreezemoonStatus").prop("checked"),userPointStatus:$("#userPointStatus").prop("checked"),userOnlineStatus:$("#userOnlineStatus").prop("checked"),userJoinPointRank:$("#joinPointRank").prop("checked"),userJoinUsedPointRank:$("#joinUsedPointRank").prop("checked"),userUAStatus:$("#userUAStatus").prop("checked")};break;case"function":i={userListPageSize:$("#userListPageSize").val(),userIndexRedirectURL:$("#userIndexRedirectURL").val(),userCommentViewMode:$("#userCommentViewMode").val(),userAvatarViewMode:$("#userAvatarViewMode").val(),userListViewMode:$("#userListViewMode").val(),userNotifyStatus:$("#userNotifyStatus").prop("checked"),userSubMailStatus:$("#userSubMailStatus").prop("checked"),userKeyboardShortcutsStatus:$("#userKeyboardShortcutsStatus").prop("checked"),userReplyWatchArticleStatus:$("#userReplyWatchArticleStatus").prop("checked"),userForwardPageStatus:$("#userForwardPageStatus").prop("checked"),chatRoomPictureStatus:$("#chatRoomPictureStatus").prop("checked")};break;case"emotionList":i=this._validateEmotionList();break;case"i18n":i={userLanguage:$("#userLanguage").val(),userTimezone:$("#userTimezone").val()};break;case"username":i={userName:$("#newUsername").val()};break;case"system":let e="";void 0!==$("#userCardSettings").attr("bgUrl")&&(e=$("#userCardSettings").attr("bgUrl"));let t="https://fishpi.cn/images/favicon.png?"+Label.staticResourceVersion;void 0!==$("#iconURL").data("imageurl")&&""!==$("#iconURL").data("imageurl")&&(t=$("#iconURL").data("imageurl")),i={systemTitle:$("#newSystemTitle").val(),cardBg:e,onlineTimeUnit:$("#onlineTimeUnit").val(),showSideAd:$("#showSideAd").prop("checked"),showTopAd:$("#showTopAd").prop("checked"),iconURL:t};break;case"deactivate":break;default:console.log("update settings has no type")}if(!i)return!1;$.ajax({url:Label.servePath+"/settings/"+e,type:"POST",headers:{csrfToken:t},cache:!1,data:JSON.stringify(i),beforeSend:function(){$("#"+e.replace(/\//g,"")+"Tip").removeClass("succ").removeClass("error").html("")},error:function(e,t,i){Util.alert(i)},success:function(t,a){if(0===t.code){if($("#"+e.replace(/\//g,"")+"Tip").addClass("succ").removeClass("error").html("<ul><li>"+Label.updateSuccLabel+"</li></ul>").show(),"profiles"===e)return $("#userNicknameDom").text(i.userNickname),$("#userTagsDom").text(i.userTags),$("#userURLDom").text(i.userURL).attr("href",i.userURL),void $("#userIntroDom").text(i.userIntro)}else $("#"+e.replace(/\//g,"")+"Tip").addClass("error").removeClass("succ").html("<ul><li>"+t.msg+"</li></ul>");$("#"+e.replace(/\//g,"")+"Tip").show(),setTimeout((function(){$("#"+e.replace(/\//g,"")+"Tip").hide(),"i18n"===e&&window.location.reload(),"deactivate"===e&&(window.location.href=Label.servePath)}),5e3)}})},updateAvatar:function(e){var t={userAvatarURL:$("#avatarURL").data("imageurl")};$.ajax({url:Label.servePath+"/settings/avatar",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){},error:function(e,t,i){Util.alert(i)},success:function(e,i){0===e.code&&$("#avatarURLDom, .user-nav .avatar-small").attr("style","background-image:url("+t.userAvatarURL+")")}})},_validateProfiles:function(){return!!Validate.goValidate({target:$("#profilesTip"),data:[{target:$("#userNickname"),type:"string",min:0,max:20,msg:Label.invalidUserNicknameLabel},{target:$("#userTags"),type:"string",min:0,max:255,msg:Label.tagsErrorLabel},{target:$("#userURL"),type:"string",min:0,max:255,msg:Label.invalidUserURLLabel},{target:$("#userIntro"),type:"string",min:0,max:255,msg:Label.invalidUserIntroLabel},{target:$("#userMbti"),type:"string",min:0,max:255,msg:"é”™è¯¯çš„MBTIé•¿åº¦"}]})&&{userNickname:$("#userNickname").val().replace(/(^\s*)|(\s*$)/g,""),userTags:$("#userTags").val().replace(/(^\s*)|(\s*$)/g,""),userURL:$("#userURL").val().replace(/(^\s*)|(\s*$)/g,""),userIntro:$("#userIntro").val().replace(/(^\s*)|(\s*$)/g,""),mbti:$("#userMbti").val().replace(/(^\s*)|(\s*$)/g,"")}},_validatePassword:function(){var e=$("#pwdOld").val(),t=$("#pwdNew").val();if(Validate.goValidate({target:$("#passwordTip"),data:[{target:$("#pwdNew"),type:"password",msg:Label.invalidPasswordLabel},{target:$("#pwdRepeat"),type:"password",oranginal:$("#pwdNew"),msg:Label.confirmPwdErrorLabel}]})){if(t!==$("#pwdRepeat").val())return!1;var i={};return i.userPassword=calcMD5(e),i.userNewPassword=calcMD5(t),i}return!1},_validateEmotionList:function(){return{emotions:$("#emotionList").val()}},makeAllNotificationsRead:function(){$.ajax({url:Label.servePath+"/notifications/all-read",type:"GET",cache:!1,success:function(e,t){0===e.code&&Settings.refreshNotificationsAllRead()}})},refreshNotificationsAllRead:function(){$.ajax({url:window.location.href,type:"GET",success:function(e){var t=$("<div>").html(e).find(".main").first();if(0!==t.length){var i=$(".main").first();0!==i.length?i.replaceWith(t):console.error("å½“å‰é¡µé¢æœªæ‰¾åˆ°classä¸ºmainçš„div")}else console.error("æœªæ‰¾åˆ°classä¸ºmainçš„div")},error:function(e,t,i){console.error("è¯·æ±‚æˆ–å¤„ç†å‡ºé”™:",i)}})},removeNotifications:function(e){return $.ajax({url:Label.servePath+"/notifications/remove/"+e,type:"GET",cache:!1,success:function(e){0===e.code&&location.reload()}}),!1},initFunction:function(){$("#emojiGrid img").click((function(){var e=$(this).attr("alt");-1===$("#emotionList").val().split(",").indexOf(e)&&(""!==$("#emotionList").val()?$("#emotionList").val($("#emotionList").val()+","+e):$("#emotionList").val(e))}))},initHome:function(){"commentsAnonymous"!==Label.type&&"comments"!==Label.type||(Util.parseHljs(),Util.parseMarkdown()),$("#reportDialog").dialog({width:$(window).width()>500?500:$(window).width()-50,height:365,modal:!0,hideFooter:!0}),"mobile"!==$.ua.device.type&&(Settings.homeScroll(),$.pjax({selector:"a",container:"#home-pjax-container",show:"",cache:!1,storage:!0,titleSuffix:"",filter:function(e){return 0>e.indexOf(Label.servePath+"/member/"+Label.userName)},callback:function(e){switch(e.type){case"success":case"cache":switch($(".home-menu a").removeClass("current"),Util.listenUserCard(),location.pathname){case"/member/"+Label.userName:case"/member/"+Label.userName+"/comments":Util.parseHljs(),Util.parseMarkdown();case"/member/"+Label.userName+"/articles/anonymous":case"/member/"+Label.userName+"/comments/anonymous":Util.parseHljs(),Util.parseMarkdown(),$(".home-menu a:eq(0)").addClass("current");break;case"/member/"+Label.userName+"/watching/articles":case"/member/"+Label.userName+"/following/users":case"/member/"+Label.userName+"/following/tags":case"/member/"+Label.userName+"/following/articles":case"/member/"+Label.userName+"/followers":$(".home-menu a:eq(1)").addClass("current");break;case"/member/"+Label.userName+"/breezemoons":$(".home-menu a:eq(1)").addClass("current"),Breezemoon.init();break;case"/member/"+Label.userName+"/points":$(".home-menu a:eq(2)").addClass("current")}}$(".nav-tabs").html($(".home-menu").html()),Util.parseMarkdown(),Util.parseHljs()}}),NProgress.configure({showSpinner:!1}),$("#home-pjax-container").bind("pjax.start",(function(){NProgress.start()})),$("#home-pjax-container").bind("pjax.end",(function(){NProgress.done()})))},currentEmojiGroupId:"",emojiGroups:[],initEmojiGroups:function(){Settings.currentEmojiGroupId="",Settings.loadEmojiGroups();var e=$("#groupEmojiList");e.on("click",".btn_add",(function(e){e.stopPropagation();const t=$(this).closest(".emoji_item").data("emoji-id"),i=$(this).closest(".emoji_item").data("name");console.log("add emoji",t),Settings.showGroupSelectDialog(t,i)})),e.on("click",".btn_delete",(function(e){e.stopPropagation();const t=$(this).closest(".emoji_item").data("emoji-id");console.log("delete emoji",t),Settings.removeEmojiFromGroup(t)})),e.on("click",".btn_rename",(function(e){e.stopPropagation();const t=$(this).closest(".emoji_item").data("id"),i=$(this).closest(".emoji_item").data("name"),a=$(this).closest(".emoji_item").data("sort")||0;Settings.editEmojiItem(t,i,a)}))},loadEmojiGroups:function(){$.ajax({url:Label.servePath+"/api/emoji/groups",type:"GET",cache:!1,success:function(e){if(0==e.code){var t=e.data||[];Settings.emojiGroups=t;for(let e=0;e<t.length;e++)if(1===t[e].type){Settings.currentEmojiGroupId=t[e].oId;break}Settings.renderEmojiGroups(t),Settings.selectEmojiGroup(Settings.currentEmojiGroupId,1)}else Util.notice("warning",2e3,e.msg||"åŠ è½½åˆ†ç»„å¤±è´¥")},error:function(){Util.notice("warning",2e3,"åŠ è½½åˆ†ç»„å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}})},renderEmojiGroups:function(e){let t=$("#emojiGroupBox");t.empty();for(let i=0;i<e.length;i++){let a=e[i],o=1===a.type;const n=$("<div>",{class:"emoji_group",id:"emojiGroup_"+a.oId,"data-id":a.oId,"data-name":a.name,"data-type":a.type}),r=$("<span>",{class:"group_name",text:a.name,css:{cursor:o?"default":"pointer"}}),s=$("<span>",{class:"group_btn btn_delete_group",text:"ğŸ—‘",css:{"margin-left":"5px",cursor:"pointer"}});if(o?n.append(r):n.append(r,s),r.on("click",(function(e){e.stopPropagation(),Settings.selectEmojiGroup(a.oId)})),!o){let e;r.on("dblclick",(function(e){e.stopPropagation(),Settings.editEmojiGroup(a.oId,a.name,a.sort)})),r.on("touchstart",(function(t){e=setTimeout((function(){t.preventDefault(),Settings.editEmojiGroup(a.oId,a.name,a.sort)}),500)})),r.on("touchend",(function(){clearTimeout(e)})),r.on("touchmove",(function(){clearTimeout(e)}))}s.on("click",(function(e){e.stopPropagation(),Settings.deleteEmojiGroupById(a.oId,a.name)})),t.append(n)}},selectEmojiGroup:function(e){let t=Settings.currentEmojiGroupId;Settings.currentEmojiGroupId=e,t!==e&&$("#emojiGroup_"+t).removeClass("emoji_group_select"),$("#emojiGroup_"+e).addClass("emoji_group_select"),Settings.loadGroupEmojis(e)},loadGroupEmojis:function(e){$.ajax({url:Label.servePath+"/api/emoji/group/emojis?groupId="+e,type:"GET",cache:!1,success:function(e){if(0==e.code){var t=e.data||[];Settings.renderGroupEmojis(t)}else Util.notice("warning",2e3,e.msg||"åŠ è½½è¡¨æƒ…å¤±è´¥")},error:function(){Util.notice("warning",2e3,"åŠ è½½è¡¨æƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}})},renderGroupEmojis:function(e){var t=$("#groupEmojiList");t.empty(),0!==e.length?(e.sort(((e,t)=>t.sort-e.sort)),e.forEach((e=>{const i=$("<div>",{class:"emoji_item","data-id":e.oId,"data-name":e.name||"","data-emoji-id":e.emojiId,"data-sort":e.sort||0}),a=$("<div>",{class:"emoji_img_wrap"}),o=$("<img>",{src:e.url,alt:""}),n=$("<div>",{class:"emoji_overlay"}),r=$("<span>",{class:"emoji_btn btn_add",text:"âœš"}),s=$("<span>",{class:"emoji_btn btn_delete",text:"ğŸ—‘"}),l=$("<span>",{class:"emoji_btn btn_rename",text:"âœ"}),c=$("<div>",{class:"emoji_name_wrap"}),d=$("<div>",{class:"emoji_name",text:e.name||""}),p=$("<div>",{class:"emoji_sort",text:"#"+(e.sort||0)});c.append(d,p),n.append(r,l,s),a.append(o),i.append(a,c,n),t.append(i)}))):t.html("<div>æš‚æ— è¡¨æƒ…</div>")},editEmojiGroup:function(e,t,i){if(e){var a='<div class="form fn-clear" style="padding: 20px;">';a+='<div style="margin-bottom: 15px;">',a+='<label style="display: block; margin-bottom: 8px;">åˆ†ç»„åç§°ï¼š</label>',a+='<input id="editGroupName" type="text" value="'+(t||"")+'" style="width: 100%; padding: 8px; box-sizing: border-box;"/>',a+="</div>",a+='<div style="margin-bottom: 15px;">',a+='<label style="display: block; margin-bottom: 8px;">æ’åºå€¼ï¼š</label>',a+='<input id="editGroupSort" type="number" value="'+(i||0)+'" style="width: 100%; padding: 8px; box-sizing: border-box;"/>',a+="</div>",a+="<br><br>",a+="<button onclick=\"Settings.confirmEditGroup('"+e+'\')" class="fn-right green">ç¡®å®š</button>',a+='<button onclick="$(\'#editGroupDialog\').dialog(\'close\')" class="fn-right" style="margin-right: 10px;">å–æ¶ˆ</button>',a+="</div>",0===$("#editGroupDialog").length&&$("body").append('<div id="editGroupDialog"></div>'),$("#editGroupDialog").html(a),$("#editGroupDialog").dialog({width:$(window).width()>400?400:$(window).width()-50,height:350,modal:!0,hideFooter:!0,title:"ç¼–è¾‘åˆ†ç»„"}),$("#editGroupDialog").dialog("open")}else Util.notice("warning",2e3,"åˆ†ç»„IDä¸èƒ½ä¸ºç©º")},confirmEditGroup:function(e){var t=$("#editGroupName").val().trim(),i=parseInt($("#editGroupSort").val());t?isNaN(i)?Util.notice("warning",2e3,"æ’åºå€¼å¿…é¡»ä¸ºæ•°å­—"):$.ajax({url:Label.servePath+"/api/emoji/group/update",type:"POST",data:JSON.stringify({groupId:e,name:t,sort:i}),contentType:"application/json;charset=UTF-8",success:function(e){0===e.code?(Util.notice("success",1200,"æ›´æ–°åˆ†ç»„æˆåŠŸ"),$("#editGroupDialog").dialog("close"),Settings.loadEmojiGroups()):Util.notice("warning",2e3,e.msg||"æ›´æ–°åˆ†ç»„å¤±è´¥")},error:function(){Util.notice("warning",2e3,"æ›´æ–°åˆ†ç»„å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}}):Util.notice("warning",2e3,"åˆ†ç»„åç§°ä¸èƒ½ä¸ºç©º")},deleteEmojiGroupById:function(e,t){e?confirm('ç¡®å®šè¦åˆ é™¤åˆ†ç»„"'+t+'"å—ï¼Ÿåˆ†ç»„å†…çš„è¡¨æƒ…ä¼šåŒæ­¥è¢«ç§»é™¤ã€‚')&&$.ajax({url:Label.servePath+"/api/emoji/group/delete",type:"POST",data:JSON.stringify({groupId:e}),contentType:"application/json;charset=UTF-8",success:function(t){if(0===t.code){if(Util.notice("success",1200,"åˆ é™¤åˆ†ç»„æˆåŠŸ"),Settings.loadEmojiGroups(),Settings.currentEmojiGroupId===e){let e="";Settings.emojiGroups.forEach((t=>{1===t.type&&(e=t.oId)})),Settings.selectEmojiGroup(e)}}else Util.notice("warning",2e3,t.msg||"åˆ é™¤åˆ†ç»„å¤±è´¥")},error:function(){Util.notice("warning",2e3,"åˆ é™¤åˆ†ç»„å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}}):Util.notice("warning",2e3,"åˆ†ç»„IDä¸èƒ½ä¸ºç©º")},createEmojiGroup:function(){var e=prompt("è¯·è¾“å…¥åˆ†ç»„åç§°ï¼š","");e&&""!==e.trim()&&$.ajax({url:Label.servePath+"/api/emoji/group/create",type:"POST",data:JSON.stringify({name:e.trim(),sort:0}),contentType:"application/json;charset=UTF-8",success:function(e){0===e.code?(Util.notice("success",1200,"åˆ›å»ºåˆ†ç»„æˆåŠŸ"),Settings.loadEmojiGroups()):Util.notice("warning",2e3,e.msg||"åˆ›å»ºåˆ†ç»„å¤±è´¥")},error:function(){Util.notice("warning",2e3,"åˆ›å»ºåˆ†ç»„å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}})},addEmojiByUrl:function(){0===$("#addUrlEmojiDialog").length&&$("body").append('<div id="addUrlEmojiDialog"></div>'),$("#addUrlEmojiDialog").html('<div class="form fn-clear" style="padding:0 20px;"></select><label>è¡¨æƒ…URLï¼š</label><br><input id="emojiUrl" type="text" placeholder="è¯·è¾“å…¥è¡¨æƒ…å›¾ç‰‡URL" style="width: 100%; padding: 8px; margin-bottom: 10px;"/><label>è¡¨æƒ…åˆ«åï¼ˆå¯é€‰ï¼‰ï¼š</label><br><input id="emojiAlias" type="text" placeholder="å¯é€‰ï¼Œè¾“å…¥è¡¨æƒ…åˆ«å" style="width: 100%; padding: 8px; margin-bottom: 10px;"/><br><br><button onclick="Settings.confirmAddUrlEmoji()" class="fn-right green">ç¡®å®š</button><button onclick="$(\'#addUrlEmojiDialog\').dialog(\'close\')" class="fn-right" style="margin-right: 10px;">å–æ¶ˆ</button></div>'),$("#addUrlEmojiDialog").dialog({width:$(window).width()>400?400:$(window).width()-50,height:300,modal:!0,hideFooter:!0,title:"é€šè¿‡URLæ·»åŠ è¡¨æƒ…"}),$("#addUrlEmojiDialog").dialog("open")},confirmAddUrlEmoji:function(){let e=Settings.currentEmojiGroupId,t=$("#emojiUrl").val().trim(),i=$("#emojiAlias").val().trim();t?$.ajax({url:Label.servePath+"/api/emoji/group/add-url-emoji",type:"POST",data:JSON.stringify({groupId:e,url:t,sort:0,name:i}),contentType:"application/json;charset=UTF-8",success:function(t){0===t.code?(Util.notice("success",1200,"æ·»åŠ è¡¨æƒ…æˆåŠŸ"),$("#addUrlEmojiDialog").dialog("close"),Settings.loadGroupEmojis(e)):Util.notice("warning",2e3,t.msg||"æ·»åŠ è¡¨æƒ…å¤±è´¥")},error:function(){Util.notice("warning",2e3,"æ·»åŠ è¡¨æƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}}):Util.notice("warning",2e3,"è¯·è¾“å…¥è¡¨æƒ…å›¾ç‰‡URL")},editEmojiItem:function(e,t,i){if(e){var a='<div class="form fn-clear" style="padding: 20px;">';a+='<div style="margin-bottom: 15px;">',a+='<label style="display: block; margin-bottom: 8px;">è¡¨æƒ…åç§°ï¼š</label>',a+='<input id="editEmojiName" type="text" value="'+(t||"")+'" style="width: 100%; padding: 8px; box-sizing: border-box;"/>',a+="</div>",a+='<div style="margin-bottom: 15px;">',a+='<label style="display: block; margin-bottom: 8px;">æ’åºå€¼ï¼š</label>',a+='<input id="editEmojiSort" type="number" value="'+(i||0)+'" style="width: 100%; padding: 8px; box-sizing: border-box;"/>',a+="</div>",a+="<br><br>",a+="<button onclick=\"Settings.confirmEditEmoji('"+e+'\')" class="fn-right green">ç¡®å®š</button>',a+='<button onclick="$(\'#editEmojiDialog\').dialog(\'close\')" class="fn-right" style="margin-right: 10px;">å–æ¶ˆ</button>',a+="</div>",0===$("#editEmojiDialog").length&&$("body").append('<div id="editEmojiDialog"></div>'),$("#editEmojiDialog").html(a),$("#editEmojiDialog").dialog({width:$(window).width()>400?400:$(window).width()-50,height:350,modal:!0,hideFooter:!0,title:"ç¼–è¾‘è¡¨æƒ…"}),$("#editEmojiDialog").dialog("open")}else Util.notice("warning",2e3,"è¡¨æƒ…IDä¸èƒ½ä¸ºç©º")},confirmEditEmoji:function(e){var t=$("#editEmojiName").val().trim(),i=parseInt($("#editEmojiSort").val());t?isNaN(i)?Util.notice("warning",2e3,"æ’åºå€¼å¿…é¡»ä¸ºæ•°å­—"):$.ajax({url:Label.servePath+"/api/emoji/emoji/update",type:"POST",data:JSON.stringify({oId:e,groupId:Settings.currentEmojiGroupId,name:t,sort:i}),contentType:"application/json;charset=UTF-8",success:function(e){0===e.code?(Util.notice("success",1200,"æ›´æ–°è¡¨æƒ…æˆåŠŸ"),$("#editEmojiDialog").dialog("close"),Settings.loadGroupEmojis(Settings.currentEmojiGroupId)):Util.notice("warning",2e3,e.msg||"æ›´æ–°è¡¨æƒ…å¤±è´¥")},error:function(){Util.notice("warning",2e3,"æ›´æ–°è¡¨æƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}}):Util.notice("warning",2e3,"è¡¨æƒ…åç§°ä¸èƒ½ä¸ºç©º")},removeEmojiFromGroup:function(e){e&&confirm("ç¡®å®šè¦ç§»é™¤è¿™ä¸ªè¡¨æƒ…å—ï¼Ÿ")&&$.ajax({url:Label.servePath+"/api/emoji/group/remove-emoji",type:"POST",data:JSON.stringify({groupId:Settings.currentEmojiGroupId,emojiId:e}),contentType:"application/json;charset=UTF-8",success:function(e){0===e.code?(Util.notice("success",1200,"ç§»é™¤è¡¨æƒ…æˆåŠŸ"),Settings.loadGroupEmojis(Settings.currentEmojiGroupId)):Util.notice("warning",2e3,e.msg||"ç§»é™¤è¡¨æƒ…å¤±è´¥")},error:function(){Util.notice("warning",2e3,"ç§»é™¤è¡¨æƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}})},showGroupSelectDialog:function(e,t){let i=Settings.emojiGroups;var a='<div class="form fn-clear" style="padding:0 20px;">';a+="<label>è¯·é€‰æ‹©è¦æ·»åŠ åˆ°çš„åˆ†ç»„ï¼š</label><br><br>",a+='<select id="groupSelect" style="width: 100%; padding: 8px; margin-bottom: 10px;">';for(var o=0;o<i.length;o++){var n=i[o];1!=n.type&&(a+='<option value="'+n.oId+'" >'+n.name+"</option>")}a+="</select>",a+="<label>è¡¨æƒ…åˆ«åï¼ˆå¯é€‰ï¼‰ï¼š</label><br>",a+='<input id="emojiName" type="text" placeholder="å¯é€‰ï¼Œè¾“å…¥è¡¨æƒ…åˆ«å" value="'+(t||"")+'" style="width: 100%; padding: 8px; margin-bottom: 10px;"/>',a+="<br><br>",a+="<button onclick=\"Settings.confirmAddEmojiToGroup('"+e+'\')" class="fn-right green">ç¡®å®š</button>',a+='<button onclick="$(\'#emojiGroupSelectDialog\').dialog(\'close\')" class="fn-right" style="margin-right: 10px;">å–æ¶ˆ</button>',a+="</div>",0===$("#emojiGroupSelectDialog").length&&$("body").append('<div id="emojiGroupSelectDialog"></div>'),$("#emojiGroupSelectDialog").html(a),$("#emojiGroupSelectDialog").dialog({width:$(window).width()>400?400:$(window).width()-50,height:350,modal:!0,hideFooter:!0,title:"é€‰æ‹©åˆ†ç»„"}),$("#emojiGroupSelectDialog").dialog("open")},confirmAddEmojiToGroup:function(e){var t=$("#groupSelect").val(),i=$("#emojiName").val().trim();t?$.ajax({url:Label.servePath+"/api/emoji/group/add-emoji",type:"POST",data:JSON.stringify({groupId:t,emojiId:e,sort:0,name:i}),contentType:"application/json;charset=UTF-8",success:function(e){0===e.code?(Util.notice("success",1200,"æ·»åŠ è¡¨æƒ…åˆ°åˆ†ç»„æˆåŠŸ"),$("#emojiGroupSelectDialog").dialog("close")):Util.notice("warning",2e3,e.msg||"æ·»åŠ è¡¨æƒ…å¤±è´¥")},error:function(){Util.notice("warning",2e3,"æ·»åŠ è¡¨æƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}}):Util.notice("warning",2e3,"è¯·é€‰æ‹©ä¸€ä¸ªåˆ†ç»„")},migrateEmojis:function(){if(!confirm("ç¡®å®šè¦è¿ç§»å†å²è¡¨æƒ…åŒ…å—ï¼Ÿ"))return;const e=$('button:contains("è¿ç§»å†å²è¡¨æƒ…")').first(),t=$("#emoji-migrate-loading").length?$("#emoji-migrate-loading"):$('<span id="emoji-migrate-loading" style="margin-left:8px;color:#1890ff;display:inline-flex;align-items:center;font-size:12px;">â³ è¿ç§»ä¸­...</span>').insertAfter(e);e.prop("disabled",!0).css("opacity",.6),t.show(),"undefined"!=typeof NProgress&&NProgress.start(),Util.notice("info",2e3,"æ­£åœ¨è¿ç§»ï¼Œè¯·ç¨å€™..."),$.ajax({url:Label.servePath+"/api/emoji/emoji/migrate",type:"POST",data:JSON.stringify({}),contentType:"application/json;charset=UTF-8",success:function(i){0===i.code?(Util.notice("success",1200,"è¿ç§»å†å²è¡¨æƒ…åŒ…æˆåŠŸ"),Settings.loadEmojiGroups()):Util.notice("warning",2e3,i.msg||"è¿ç§»å†å²è¡¨æƒ…åŒ…å¤±è´¥"),"undefined"!=typeof NProgress&&NProgress.done(),e.prop("disabled",!1).css("opacity",1),t.hide()},error:function(){Util.notice("warning",2e3,"è¿ç§»å†å²è¡¨æƒ…åŒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"),"undefined"!=typeof NProgress&&NProgress.done(),e.prop("disabled",!1).css("opacity",1),t.hide()}})}};