var EmojiGroups={init:function(o,e){e=e||"New";var r=window[o];r?(r["emojiGroups"+e]=[],r["emojiGroupsData"+e]={},r["currentEmojiGroupId"+e]=null,r["loadEmojiGroups"+e]=EmojiGroups._createLoadMethod(r,e),r["renderEmojiGroups"+e]=EmojiGroups._createRenderMethod(r,e),r["selectEmojiGroup"+e]=EmojiGroups._createSelectMethod(r,e),r["loadGroupEmojis"+e]=EmojiGroups._createLoadEmojisMethod(r,e,o),r["renderGroupEmojis"+e]=EmojiGroups._createRenderEmojisMethod(r,e,o),r["uploadEmojiToGroup"+e]=EmojiGroups._createUploadEmojiMethod(r,e),console.log("表情包分组模块已挂载到对象:",o)):console.error("目标对象不存在:",o)},_createLoadMethod:function(o,e){return function(){$.ajax({url:Label.servePath+"/emoji/groups",type:"GET",cache:!1,success:function(r){if(0==r.code){var t=r.data||[];o["emojiGroups"+e]=t,o["renderEmojiGroups"+e](t);for(let r=0;r<t.length;r++)if(1===t[r].type){o["currentEmojiGroupId"+e]=t[r].oId,setTimeout((function(){o["selectEmojiGroup"+e](t[r].oId)}),50);break}}else console.error("加载分组失败:",r.msg)},error:function(){console.error("加载分组失败，请检查网络")}})}},_createRenderMethod:function(o,e){return function(r){let t=$("#emojiGroupBox"+e);if(0!==t.length){t.empty();for(let i=0;i<r.length;i++){let n=r[i],s=$("<div>",{class:"emoji_group_"+e,id:"emojiGroup"+e+"_"+n.oId,"data-id":n.oId,"data-name":n.name,"data-type":n.type,css:{padding:"8px 12px",cursor:"pointer","border-bottom":"1px solid #eee","font-size":"14px",overflow:"hidden","line-clamp":"1","white-space":"nowrap","text-overflow":"ellipsis"}}),a=$("<span>",{class:"group_name_"+e,text:n.name,css:{display:"inline-block",width:"100%"}});a.on("click",(function(r){r.stopPropagation();var t=$(this).closest(".emoji_group_"+e).data("id");o["selectEmojiGroup"+e](t)})),s.append(a),t.append(s)}}}},_createSelectMethod:function(o,e){return function(r){o["currentEmojiGroupId"+e]=r,$(".emoji_group_"+e).css({"background-color":"",color:"","font-weight":""}),$("#emojiGroup"+e+"_"+r).css({"background-color":"#e6f7ff",color:"#1890ff","font-weight":"bold"}),o["loadGroupEmojis"+e](r)}},_createLoadEmojisMethod:function(o,e,r){return function(r){o["emojiGroupsData"+e][r]?o["renderGroupEmojis"+e](o["emojiGroupsData"+e][r]):$.ajax({url:Label.servePath+"/emoji/group/emojis?groupId="+r,type:"GET",cache:!1,success:function(t){if(0==t.code){var i=t.data||[];o["emojiGroupsData"+e][r]=i,o["renderGroupEmojis"+e](i)}else console.error("加载表情失败:",t.msg)},error:function(){console.error("加载表情失败，请检查网络")}})}},_createRenderEmojisMethod:function(o,e,r){return function(t){var i="";if(o.editor){if(0===t.length){i='<div style="text-align: center; padding: 20px; color: #999; line-height: 1.6;">该分组暂无表情<br><a style="color:#1890ff;" target="_blank" href="'+(Label.servePath+"/settings/function#emojiGroupBox")+'">前往表情包管理迁移旧表情</a></div>'}else{t.sort((function(o,e){return e.sort-o.sort}));for(let o=0;o<t.length;o++){i+='<button class="emoji-insert-btn" data-url="'+String(t[o].url||"").replace(/"/g,"&quot;")+'">',i+='<img style="max-height: 50px" class="vditor-emojis__icon" src="'+t[o].url+'">',i+="</button>"}}var n=$("#emojis"+e);n.html(i),n.off("click.emojiInsert").on("click.emojiInsert","button.emoji-insert-btn",(function(o){o.preventDefault();var e=$(this).data("url");EmojiGroups.insertEmojiToEditor(r,e)}))}else console.error("编辑器对象不存在")}},_createUploadEmojiMethod:function(o,e){return function(o){$.ajax({url:Label.servePath+"/emoji/upload",type:"POST",data:{url:o},headers:{csrfToken:Label.csrfToken},cache:!1,success:function(o){0==o.code||(console.error("上传表情失败:",o.msg),alert("上传表情失败: "+o.msg))},error:function(){console.error("上传表情失败，请检查网络"),alert("上传表情失败，请检查网络")}})}},insertEmojiToEditor:function(o,e){var r=window[o];r&&r.editor?(r.editor.focus&&r.editor.focus(),r.editor.setValue(r.editor.getValue()+"![图片表情]("+e+")"),r.editor.focus&&r.editor.focus(),EmojiGroups.closePanel()):console.error("编辑器对象不存在")},closePanel:function(){var o=$("#emojiList");o.length&&o.removeClass("showList")}};