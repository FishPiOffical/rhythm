var Shop={history:[],cursor:1,init:function(){Shop.log("Client","正在连接服务器，请稍等..."),Shop.resetInput(),$("body").on("keydown",(function(o){if(13===o.keyCode){let o=$(".i-cmd").text();if(Shop.history[Shop.history.length]=o,Shop.log("Input",o),"history"===o){let o="";o+="===== 命令历史 =====<br>";for(let e=0;e<Shop.history.length;e++)o+=e+"&nbsp;"+Shop.history[e]+"<br>";Shop.log("Client","<br>"+o)}else $.ajax({url:Label.servePath+"/shop",method:"post",data:JSON.stringify({command:o}),cache:!1,async:!0});setTimeout((function(){Shop.resetInput(),Shop.cursor=Shop.history.length}),100)}else 38===o.keyCode?(Shop.cursor<=0&&(Shop.cursor=1),Shop.cursor--,console.log(Shop.cursor),$(".i-cmd").text(Shop.history[Shop.cursor])):40===o.keyCode?(Shop.cursor>Shop.history.length-1&&(Shop.cursor=Shop.history.length-2),Shop.cursor<=-1&&(Shop.cursor=-1),Shop.cursor++,console.log(Shop.cursor),Shop.cursor===Shop.history.length?$(".i-cmd").text(""):$(".i-cmd").text(Shop.history[Shop.cursor])):9===o.keyCode&&$(".i-cmd").text(Shop.lenovo($(".i-cmd").text()))})),$(".subInput").on("click",(function(){setTimeout((function(){console.log("Reset cursor"),$(".i-cmd").focus()}),100)}))},lenovo:function(o){let e=["help","history"],s=o.split(" "),n=s[s.length-1],t="";for(let o=0;o<e.length;o++){let l=e[o];if(l.startsWith(n)){s[s.length-1]=l;for(let o=0;o<s.length;o++){let e=s[o];o===s.length-1?t+=e:t+=e+" "}break}}return t},log:function(o,e){if(void 0===o&&(o="N/A"),"Input"===o)$(".logs").append("\n<div class='subLog'>>&nbsp;"+e+"</div>");else{let s=new Date;o="["+("0"+s.getHours()).slice(-2)+":"+("0"+s.getMinutes()).slice(-2)+":"+("0"+s.getSeconds()).slice(-2)+"&nbsp;"+o+"]&nbsp;",$(".logs").append("\n<div class='subLog'>"+o+e+"</div>")}},resetInput:function(o,e){void 0===e&&(e=""),void 0===o&&(o="~"),$(".input").html("<div class='subInput'><span class='i-name'>"+Label.currentUserName+"</span><span class='i-at'>@</span><span class='i-host'>"+Label.servePath.replace("http://","").replace("https://","")+"</span><span class='i-colon'>:</span><span class='i-location'>"+o+"</span><span class='i-user-as'>$</span><span class='i-space'>&nbsp;</span><span class='i-cmd' contenteditable='true'>"+e+"</span></div>"),$(".i-cmd").focus()}},ShopChannel={ws:void 0,init:function(o){ShopChannel.ws=new WebSocket(o),ShopChannel.ws.onopen=function(){Shop.log("Client","连接成功，已启动命令通道。")},ShopChannel.ws.onmessage=function(o){var e=JSON.parse(o.data);Shop.log("Server",e.message)},ShopChannel.ws.onclose=function(){Shop.log("Client","与服务端的连接已断开，正在尝试重连..."),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)},ShopChannel.ws.onerror=function(o){Shop.log("Client","连接出错，正在尝试重连..."),setInterval((function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})}),1e4)}}};