var Shop={history:[],cursor:1,init:function(){Shop.log("Client","正在连接服务器，请稍等..."),Shop.resetInput(),$("body").on("keydown",function(o){if(13===o.keyCode){var s=$(".i-cmd").text();if(Shop.history[Shop.history.length]=s,Shop.log("Input",s),"history"===s){let s="";s+="===== 命令历史 =====<br>";for(let o=0;o<Shop.history.length;o++)s+=o+"&nbsp;"+Shop.history[o]+"<br>";Shop.log("Client","<br>"+s)}else $.ajax({url:Label.servePath+"/shop",method:"post",data:JSON.stringify({command:s}),cache:!1,async:!0});setTimeout(function(){Shop.resetInput(),Shop.cursor=Shop.history.length},100)}else 38===o.keyCode?(Shop.cursor<=0&&(Shop.cursor=1),Shop.cursor--,console.log(Shop.cursor),$(".i-cmd").text(Shop.history[Shop.cursor])):40===o.keyCode?(Shop.cursor>Shop.history.length-1&&(Shop.cursor=Shop.history.length-2),Shop.cursor<=-1&&(Shop.cursor=-1),Shop.cursor++,console.log(Shop.cursor),Shop.cursor===Shop.history.length?$(".i-cmd").text(""):$(".i-cmd").text(Shop.history[Shop.cursor])):9===o.keyCode&&$(".i-cmd").text(Shop.lenovo($(".i-cmd").text()))}),$(".subInput").on("click",function(){setTimeout(function(){console.log("Reset cursor"),$(".i-cmd").focus()},100)})},lenovo:function(o){var s=["help","history"],e=o.split(" "),n=e[e.length-1];let t="";for(let o=0;o<s.length;o++){var r=s[o];if(r.startsWith(n)){e[e.length-1]=r;for(let o=0;o<e.length;o++){var h=e[o];o===e.length-1?t+=h:t+=h+" "}break}}return t},log:function(o,s){var e;"Input"===(o=void 0===o?"N/A":o)?$(".logs").append("\n<div class='subLog'>>&nbsp;"+s+"</div>"):(o="["+("0"+(e=new Date).getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"&nbsp;"+o+"]&nbsp;",$(".logs").append("\n<div class='subLog'>"+o+s+"</div>"))},resetInput:function(o,s){void 0===s&&(s=""),void 0===o&&(o="~"),$(".input").html("<div class='subInput'><span class='i-name'>"+Label.currentUserName+"</span><span class='i-at'>@</span><span class='i-host'>"+Label.servePath.replace("http://","").replace("https://","")+"</span><span class='i-colon'>:</span><span class='i-location'>"+o+"</span><span class='i-user-as'>$</span><span class='i-space'>&nbsp;</span><span class='i-cmd' contenteditable='true'>"+s+"</span></div>"),$(".i-cmd").focus()}},ShopChannel={ws:void 0,init:function(o){ShopChannel.ws=new WebSocket(o),ShopChannel.ws.onopen=function(){Shop.log("Client","连接成功，已启动命令通道。")},ShopChannel.ws.onmessage=function(o){o=JSON.parse(o.data);Shop.log("Server",o.message)},ShopChannel.ws.onclose=function(){Shop.log("Client","与服务端的连接已断开，正在尝试重连..."),setInterval(function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})},1e4)},ShopChannel.ws.onerror=function(o){Shop.log("Client","连接出错，正在尝试重连..."),setInterval(function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})},1e4)}}};