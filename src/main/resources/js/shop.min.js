var Shop={history:[],cursor:1,init:function(){Shop.log("Client","正在连接服务器，请稍等..."),Shop.resetInput(),$("body").on("keydown",(function(o){if(13===o.keyCode){let o=$(".i-cmd").text();if(Shop.history[Shop.history.length]=o,Shop.log("Input",o),"history"===o){let o="";o+="===== 命令历史 =====<br>";for(let s=0;s<Shop.history.length;s++)o+=s+"&nbsp;"+Shop.history[s]+"<br>";Shop.log("Client","<br>"+o)}else $.ajax({url:Label.servePath+"/shop",method:"post",data:JSON.stringify({command:o}),cache:!1,async:!0});setTimeout((function(){Shop.resetInput(),Shop.cursor=Shop.history.length}),100)}else 38===o.keyCode?(Shop.cursor<=0&&(Shop.cursor=1),Shop.cursor--,console.log(Shop.cursor),$(".i-cmd").text(Shop.history[Shop.cursor])):40===o.keyCode?(Shop.cursor>Shop.history.length-1&&(Shop.cursor=Shop.history.length-2),Shop.cursor<=-1&&(Shop.cursor=-1),Shop.cursor++,console.log(Shop.cursor),Shop.cursor===Shop.history.length?$(".i-cmd").text(""):$(".i-cmd").text(Shop.history[Shop.cursor])):9===o.keyCode&&$(".i-cmd").text(Shop.lenovo($(".i-cmd").text()))})),$(".subInput").on("click",(function(){setTimeout((function(){console.log("Reset cursor"),$(".i-cmd").focus()}),100)}))},lenovo:function(o){let s=["help","history"],e=o.split(" "),n=e[e.length-1],t="";for(let o=0;o<s.length;o++){let p=s[o];if(p.startsWith(n)){e[e.length-1]=p;for(let o=0;o<e.length;o++){let s=e[o];o===e.length-1?t+=s:t+=s+" "}break}}return t},log:function(o,s){if(void 0===o&&(o="N/A"),"Input"===o)$(".logs").append("\n<div class='subLog'>>&nbsp;"+s+"</div>");else{let e=new Date;o="["+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"&nbsp;"+o+"]&nbsp;",$(".logs").append("\n<div class='subLog'>"+o+s+"</div>")}},resetInput:function(o,s){void 0===s&&(s=""),void 0===o&&(o="~"),$(".input").html("<div class='subInput'><span class='i-name'>"+Label.currentUserName+"</span><span class='i-at'>@</span><span class='i-host'>"+Label.servePath.replace("http://","").replace("https://","")+"</span><span class='i-colon'>:</span><span class='i-location'>"+o+"</span><span class='i-user-as'>$</span><span class='i-space'>&nbsp;</span><span class='i-cmd' contenteditable='true'>"+s+"</span></div>"),$(".i-cmd").focus()}},ShopChannel={ws:void 0,init:function(o){ShopChannel.ws=new ReconnectingWebSocket(o),ShopChannel.ws.onopen=function(){Shop.log("Client","连接成功，已启动命令通道。")},setInterval((function(){ShopChannel.ws.send("p")}),3e4),ShopChannel.ws.onmessage=function(o){var s=JSON.parse(o.data);Shop.log("Server",s.message)},ShopChannel.ws.onclose=function(){Shop.log("Client","与服务端的连接已断开，正在尝试重连...")},ShopChannel.ws.onerror=function(o){Shop.log("Client","连接出错，正在尝试重连...")}}};