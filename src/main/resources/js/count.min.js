const Count={generateInterval:0,data:{},init:function(){const t=JSON.parse(localStorage.getItem("count"))||{};t.time=t.time||"1800",t.lunch=t.lunch||"1130",this.data=t,this.save(),"disabled"!==t.status&&(this.initHtml(),this.start())},initHtml:function(){const t=document.createElement("div"),a=this.data;t.id="timeContent",a.left&&a.top&&document.documentElement.clientHeight>a.top&&document.documentElement.clientWidth>a.left&&t.setAttribute("style","left:"+a.left+"px;top:"+a.top+"px;"),t.innerHTML="<a class='time_box' id='countRemainBox'>距离下班:<br><span id='countRemain'></span></a>",document.body.insertBefore(t,document.body.firstChild);let s=document.getElementById("timeContent");s.onmousedown=t=>{let n=t.clientX-s.offsetLeft,i=t.clientY-s.offsetTop,l,o;document.onmousemove=function(t){var e=t.clientX-n,t=t.clientY-i;l=e,o=t,a.left=e,a.top=t,Count.data=a,Count.save(),0<=e&&e<=window.innerWidth-s.offsetWidth&&(s.style.left=e+"px"),0<=t&&t<=window.innerHeight-s.offsetHeight&&(s.style.top=t+"px")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,void 0===l&&void 0===o&&Count.settings()}}},generate:function(){var t=(new Date).getFullYear()+`-${("0"+((new Date).getMonth()+1)).slice(-2)}-`+("0"+(new Date).getDate()).slice(-2),e=Count.data.time.match(/\d{2}/g);const n=new Date(t+` ${e[0]}:${e[1]}:00`),i=new Date;e=Count.data.lunch.match(/\d{2}/g);const l=new Date(t+` ${e[0]}:${e[1]}:00`);i.getTime()===l.getTime()&&Util.notice("success",15e3,"中午咯，该订饭啦～");t=n.getTime()-i.getTime(),e=Math.floor(t/36e5%24);let o=Math.floor(t/6e4%60),a=Math.floor(t/1e3%60);0<=e&&0<=o&&0<=a?(e=("0"+e).slice(-2),o=("0"+o).slice(-2),a=("0"+a).slice(-2),t=e+":"+o+":"+a,"00"===e&&"02"===o&&"00"===a&&Util.notice("danger",3e3,"马上就要下班啦，赶快收拾收拾吧～"),"00"===e&&"00"===o&&"00"===a&&Util.notice("success",3e3,"下班了！下班了！下班了！！！"),document.getElementById("countRemain").innerText=t):(document.getElementById("countRemainBox").innerText="下班\n时间到 🎉",clearInterval(Count.generateInterval))},start:function(){Count.generate(),Count.generateInterval=setInterval(function(){Count.generate()},1e3)},save:function(){localStorage.setItem("count",JSON.stringify(this.data))},settings:function(){Util.alert(`<div class="form fn__flex-column">
<label>
  <div class="ft__smaller ft__fade" style="float: left">状态（关闭后可点击右上角头像找到下班倒计时设定）</div>
  <div class="fn-hr5 fn__5"></div>
  <select id="countSettingStatus">
  <option value="enabled" selected>开启</option>  <option value="disabled">关闭</option>  </select>
</label>
<label>
  <div class="ft__smaller ft__fade" style="float: left">下班时间</div>
  <div class="fn-hr5 fn__5"></div>
  <input id="countSettingsTime" type="time"/>
</label>
<label>
  <div class="ft__smaller ft__fade" style="float: left">订饭时间</div>
  <div class="fn-hr5 fn__5"></div>
  <input id="lunchSettingsTime" type="time"/>
</label>
<div class="fn-hr5"></div>
<div class="fn__flex" style="margin-top: 15px">
<div class="fn__flex-1 fn__flex-center" style="text-align: left;"></div>
  <button class="btn btn--confirm" onclick='Count.saveSettings()'>保存</button>
</div>
</div>`,"下班倒计时设定"),setTimeout(function(){var t=Count.data.time.match(/\d{2}/g);document.getElementById("countSettingsTime").value=t[0]+":"+t[1];t=Count.data.lunch.match(/\d{2}/g);document.getElementById("lunchSettingsTime").value=t[0]+":"+t[1],document.getElementById("countSettingStatus").value="disabled"===Count.data.status?"disabled":"enabled"},500)},saveSettings:function(){Count.data.time=document.getElementById("countSettingsTime").value.replace(":",""),Count.data.lunch=document.getElementById("lunchSettingsTime").value.replace(":",""),Count.data.status=document.getElementById("countSettingStatus").value,Count.save(),Util.closeAlert(),location.reload()}};$(document).ready(function(){Count.init()});